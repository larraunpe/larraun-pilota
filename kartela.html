<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta property="og:image" content="https://larraunpilota.eus/preview-escritorio.jpg">
<meta property="og:title" content="Asteko Partiduak ‚Äì Larraun Pilota">

<title>Larraun ‚Äì Asteko Kartela</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
/* ================= BASE ================= */
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#e4efe8;
}

/* ================= CARTEL FRONT√ìN ================= */
.cartel{
  position: relative; /* necesario para pelotazos absolutos */
  max-width:900px;
  margin:20px auto;
  padding:20px 24px 30px;
  border-radius:14px;
  overflow:hidden;
  background:#dfeee4;
  box-shadow:0 10px 28px rgba(0,0,0,.35);
}

/* ================= PELOTAZOS EXPLOSIVOS ================= */
.pelotazos {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;
}

.pelotazos .pelota {
  position: absolute;
  border-radius: 50%;
}

/* ================= BOT√ìN ================= */
.exportar{text-align:center;margin:14px 0}
.exportar button{
  background:#1b5e20;
  color:#fff;
  border:none;
  padding:10px 18px;
  border-radius:20px;
  cursor:pointer;
}

/* ================= HEADER ================= */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:16px;
  position: relative; z-index:1;
}
.header img{height:64px}
.header h1{
  margin:0;
  font-size:2em;
  letter-spacing:2px;
  color:#004d40;
}

/* ================= BLOQUES ================= */
.bloque{margin-top:28px; position: relative; z-index:1;}

.bloque h2{
  text-align:center;
  font-size:1.45em;
  color:#1b5e20;
  font-weight:800;
  margin-bottom:14px;
}

/* ================= GRUPO PAPEL PEGADO ================= */
.grupo{
  position:relative;
  margin-top:14px;
  background:#ffffffee;
  border-radius:10px;
  z-index:1;
  box-shadow:
    0 4px 10px rgba(0,0,0,.25),
    0 1px 0 rgba(255,255,255,.6) inset;
}

.grupo::after{
  content:"";
  position:absolute;
  inset:0;
  opacity:.3; 
  pointer-events:none;
  background:
    radial-gradient(circle at 10% 15%, #000 2px, transparent 4px),
    radial-gradient(circle at 25% 40%, #000 2px, transparent 4px),
    radial-gradient(circle at 40% 20%, #000 2px, transparent 4px),
    radial-gradient(circle at 55% 60%, #000 2px, transparent 4px),
    radial-gradient(circle at 70% 35%, #000 2px, transparent 4px),
    radial-gradient(circle at 85% 70%, #000 2px, transparent 4px),
    radial-gradient(circle at 50% 80%, #000 2px, transparent 4px),
    radial-gradient(circle at 30% 65%, #000 2px, transparent 4px);
}

/* ================= HEADER GRUPO ================= */
.grupo-header{
  background:#e3f2fd;
  padding:10px 14px;
  font-weight:bold;
  color:#0d47a1;
}
.grupo-header.rojo{
  background:#f8d7da;
  color:#842029;
}

/* ================= LINEA PARTIDO ================= */
.linea{
  padding:8px 14px;
  border-top:1px solid #ddd;
  display:flex;
  gap:10px;
  font-size:.95em;
}

.zkia{width:26px;font-weight:bold}
.etxekoa{color:#0d47a1;font-weight:bold}
.kanpokoa{color:#b71c1c;font-weight:bold}

.lehiaketa{
  margin-left:auto;
  text-align:right;
}
.fase{font-weight:bold}
</style>
</head>

<body>

<div class="exportar">
  <button onclick="exportarJPG()">üì∏ DESKARGATU KARTELA (JPG)</button>
</div>

<div class="cartel" id="kartela">
  <!-- Pelotazos explosivos -->
  <div class="pelotazos"></div>

  <div class="header">
    <img src="/images/logo-larraun.png">
    <h1>LARRAUN PILOTA ELKARTEA</h1>
    <img src="/images/logo-fnp.png">
  </div>

  <div id="content"></div>
</div>

<script>
/* ================= GENERAR PELOTAZOS ================= */
function generarPelotazos(numPelotazos = 200){
  const cont = document.querySelector(".pelotazos");
  const cartel = document.getElementById("kartela");
  const ancho = cartel.offsetWidth;
  const alto = cartel.offsetHeight;

  for(let i=0; i<numPelotazos; i++){
    const div = document.createElement("div");
    const size = Math.random()*12 + 4; // tama√±o 4px a 16px
    div.style.width = div.style.height = size + "px";
    div.style.left = Math.random()*ancho + "px";
    div.style.top = Math.random()*alto + "px";
    div.style.background = `rgba(0,0,0,${Math.random()*0.5 + 0.2})`;
    div.style.borderRadius = "50%";
    div.style.position = "absolute";
    cont.appendChild(div);
  }
}

// Ejecutamos cuando todo el contenido est√© cargado
window.addEventListener("load", ()=> generarPelotazos(200));
  
generarPelotazos(200); // Cambia a 300 para m√°s efecto

/* ================= JPG ================= */
function exportarJPG(){
  html2canvas(document.getElementById("kartela"),{
    scale:2,
    backgroundColor:"#ffffff"
  }).then(canvas=>{
    const link=document.createElement("a");
    link.download="asteko-partiduak.jpg";
    link.href=canvas.toDataURL("image/jpeg",0.95);
    link.click();
  });
}

/* ================= L√ìGICA ORIGINAL ================= */
function normalizaHora(h){
  return h ? h.slice(0,5) : "00:00";
}

function ordenar(data){
  return data.sort((a,b)=>{
    if(a.fecha!==b.fecha) return a.fecha.localeCompare(b.fecha);
    return normalizaHora(a.hora).localeCompare(normalizaHora(b.hora));
  });
}

function agrupar(data){
  const g={};
  data.forEach(p=>{
    const key=`${p.fecha}|${normalizaHora(p.hora)}|${p.fronton}`;
    if(!g[key]) g[key]=[];
    g[key].push(p);
  });
  return g;
}

Promise.all([
  fetch("/data/cartelera-larraun.json").then(r=>r.json()),
  fetch("/data/partidos-no-oficiales.json").then(r=>r.json())
]).then(([oficiales,noOficiales])=>{

  const bloques=[
    {titulo:"ORDUTEGIAK", data:ordenar(oficiales)},
    {titulo:"BESTE TXAPELKETAK OFIZIALAK", data:ordenar(noOficiales.filter(p=>String(p.ofiziala)==="true"))},
    {titulo:"TXAPELKETAK EZ OFIZIALAK", data:ordenar(noOficiales.filter(p=>String(p.ofiziala)!=="true"))}
  ];

  const cont=document.getElementById("content");

  bloques.forEach(b=>{
    if(!b.data.length) return;

    cont.innerHTML+=`<div class="bloque"><h2>${b.titulo}</h2></div>`;
    const bloqueDiv=cont.lastChild;

    const grupos=agrupar(b.data);

    Object.values(grupos).forEach(partidos=>{
      const p0=partidos[0];
      const esLocal=/lekunberri|aldatz/i.test(p0.fronton||"");

      bloqueDiv.innerHTML+=`
      <div class="grupo">
        <div class="grupo-header ${!esLocal?'rojo':''}">
          üìÖ ${p0.fecha} | ‚è∞ ${normalizaHora(p0.hora)} | üìç ${p0.fronton}
        </div>

        ${partidos.map(p=>`
          <div class="linea">
            <div class="zkia">${p.zkia}</div>
            <div class="etxekoa">${p.etxekoa||""}</div>
            <div class="kanpokoa">${p.kanpokoak||""}</div>
            <div class="lehiaketa">${p.lehiaketa||""}</div>
          </div>
        `).join("")}
      </div>`;
    });
  });
});
</script>

</body>
</html>
