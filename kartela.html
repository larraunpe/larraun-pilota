<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<title>Asteko Partiduak</title>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#f0f0f0;
}

main{
  max-width:1000px;
  margin:20px auto;
  padding:0 12px;
}

/* ===== BLOQUES ===== */
.bloque{
  margin-bottom:30px;
}

.bloque h2{
  margin:10px 0 14px;
  padding-left:8px;
  border-left:6px solid #0d47a1;
  color:#0d47a1;
}

/* ===== TARJETA ===== */
.match{
  background:#fff;
  border-radius:10px;
  box-shadow:0 3px 8px rgba(0,0,0,.2);
  margin-bottom:12px;
  overflow:hidden;
}

/* CABECERA */
.match-header{
  background:#f2bcbc;
  padding:8px 12px;
  font-size:.9em;
  font-weight:bold;
}

/* CUERPO */
.match-body{
  display:grid;
  grid-template-columns:60px 1fr 1fr;
  gap:12px;
  padding:12px;
  align-items:center;
}

.zkia{
  font-size:1.6em;
  font-weight:800;
  text-align:center;
}

/* EQUIPOS */
.equipos{
  line-height:1.4;
}

.etxekoa{
  color:#0d47a1;
  font-weight:bold;
}

.kanpokoa{
  color:#b71c1c;
  font-weight:bold;
}

.larraun{
  text-transform:uppercase;
  font-size:1.1em;
}

/* LEHIAKETA */
.lehiaketa{
  font-size:.95em;
}

.fase{
  font-weight:800;
  margin-top:4px;
}
</style>
</head>

<body>

<main id="content"></main>

<script>
function parseDate(d){ return new Date(d+"T00:00"); }

function detectarFase(t){
  const fases=[
    "FINAL LAURDENEN LIGAXKA",
    "FINAL LAURDENAK",
    "FINAL AURREKOAK",
    "FINALA",
    "LIGAXKA",
    "KANPORAKETA",
    "KAMPORAKETA"
  ];
  for(const f of fases){
    if(t.toUpperCase().includes(f)) return f;
  }
  return "";
}

function limpiarLehiaketa(t,f){
  return f ? t.replace(new RegExp(f,"i"),"").trim() : t;
}

function ordenar(arr){
  return arr.sort((a,b)=>{
    if(a.fecha!==b.fecha) return a.fecha.localeCompare(b.fecha);
    if(a.hora!==b.hora) return a.hora.localeCompare(b.hora);
    if(a.fronton!==b.fronton) return a.fronton.localeCompare(b.fronton);
    return (a.zkia||0)-(b.zkia||0);
  });
}

Promise.all([
  fetch("/data/competiciones-larraun.json").then(r=>r.json()),
  fetch("/data/partidos-no-oficiales.json").then(r=>r.json())
]).then(([oficiales,noOficiales])=>{

  const bloques=[
    {titulo:"LEHIAKETA OFIZIALAK", data:oficiales},
    {titulo:"BESTE TXAPELKETAK OFIZIALAK",
     data:noOficiales.filter(p=>String(p.ofiziala)==="true")},
    {titulo:"TXAPELKETAK EZ OFIZIALAK",
     data:noOficiales.filter(p=>String(p.ofiziala)!=="true")}
  ];

  const c=document.getElementById("content");

  bloques.forEach(b=>{
    if(!b.data.length) return;

    const arr=ordenar(b.data);

    let html=`<div class="bloque"><h2>${b.titulo}</h2>`;

    arr.forEach(p=>{
      const fase=detectarFase(p.lehiaketa||"");
      const base=limpiarLehiaketa(p.lehiaketa||"",fase);

      const etxL=/larraun/i.test(p.etxekoa||"");
      const kanL=/larraun/i.test(p.kanpokoak||"");

      html+=`
      <div class="match">
        <div class="match-header">
          üìÖ ${p.fecha} ¬∑ ‚è∞ ${p.hora} ¬∑ üìç ${p.fronton}
        </div>

        <div class="match-body">
          <div class="zkia">${p.zkia}</div>

          <div class="equipos">
            <div class="etxekoa ${etxL?'larraun':''}">
              ${p.etxekoa||""}
            </div>
            <div class="kanpokoa ${kanL?'larraun':''}">
              ${p.kanpokoak||""}
            </div>
          </div>

          <div class="lehiaketa">
            ${base}
            ${fase?`<div class="fase">${fase}</div>`:""}
          </div>
        </div>
      </div>`;
    });

    html+=`</div>`;
    c.innerHTML+=html;
  });
});
</script>

</body>
</html>
