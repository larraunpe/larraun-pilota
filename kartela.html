<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<title>Asteko Kartela</title>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#eaeaea;
}

.cartel{
  max-width:900px;
  margin:20px auto;
  background:white;
  border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.25);
  overflow:hidden;
}

/* ===== CABECERA GENERAL ===== */
.top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 18px;
  background:#ffffff;
  box-shadow:0 3px 10px rgba(0,0,0,.15);
}

.top img{ height:46px; }

.top h1{
  margin:0;
  font-size:1.8em;
  letter-spacing:2px;
  color:#0d47a1;
}

/* ===== CONTENIDO ===== */
#contenido{
  padding:18px;
}

/* ===== GRUPO ===== */
.grupo{
  margin-bottom:18px;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 3px 10px rgba(0,0,0,.2);
}

/* CABECERA GRUPO */
.grupo-header{
  padding:10px 14px;
  font-weight:bold;
  color:white;
}

.header-azul{ background:#1976d2; }
.header-rojo{ background:#ef9a9a; color:#4a0000; }

.lekua-destacado{
  font-style:italic;
  font-weight:800;
}

/* ===== PARTIDOS ===== */
.partido{
  padding:10px 14px;
  border-top:1px solid #ddd;
}

/* LINEA 1 */
.linea1{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:14px;
  text-align:center;
  font-size:.95em;
}

.zkia{
  font-weight:800;
  min-width:32px;
}

.lehiaketa{
  line-height:1.2;
}

.fase{
  font-weight:800;
  margin-top:2px;
}

/* LINEA 2 */
.linea2{
  margin-top:6px;
  text-align:center;
}

.equipo{
  font-weight:bold;
  line-height:1.25;
}

.azul{ color:#0d47a1; }
.rojo{ color:#b71c1c; }

.larraun{
  text-transform:uppercase;
  font-size:1.1em;
}
</style>
</head>

<body>

<div class="cartel">

  <div class="top">
    <img src="/images/logo-larraun.png" alt="Larraun">
    <h1>ASTEKO PARTIDUAK</h1>
    <img src="/images/logo-fnp.png" alt="FNP">
  </div>

  <div id="contenido"></div>
</div>

<script>
function hora(h){ return h ? h.slice(0,5) : "00:00"; }
function esLekunberriAldatz(t){ return /lekunberri|aldatz/i.test(t||""); }

function detectarFase(t){
  const fases=[
    "FINAL LAURDENEN LIGAXKA",
    "FINAL LAURDENAK",
    "FINAL AURREKOAK",
    "FINALA",
    "LIGAXKA",
    "KANPORAKETA",
    "KAMPORAKETA"
  ];
  for(const f of fases){
    if(t.toUpperCase().includes(f)) return f;
  }
  return "";
}

function limpiarLehiaketa(t,f){
  return f ? t.replace(new RegExp(f,"i"),"").trim() : t;
}

function agrupar(data){
  const g={};
  data.forEach(p=>{
    const k=`${p.fecha}|${hora(p.hora)}|${p.fronton}`;
    if(!g[k]) g[k]=[];
    g[k].push(p);
  });
  Object.values(g).forEach(a=>a.sort((x,y)=>(x.zkia||0)-(y.zkia||0)));
  return g;
}

fetch("/data/cartelera-larraun.json")
.then(r=>r.json())
.then(data=>{
  const cont=document.getElementById("contenido");
  const grupos=agrupar(data);

  Object.entries(grupos).forEach(([k,arr])=>{
    const p0=arr[0];
    const especial=esLekunberriAldatz(p0.fronton);

    let html=`
      <div class="grupo">
        <div class="grupo-header ${especial?'header-azul':'header-rojo'}">
          üìÖ ${p0.fecha} ¬∑ ‚è∞ ${hora(p0.hora)} ¬∑
          <span class="${especial?'lekua-destacado':''}">${p0.fronton}</span>
        </div>
    `;

    arr.forEach(p=>{
      const fase=detectarFase(p.lehiaketa||"");
      const base=limpiarLehiaketa(p.lehiaketa||"",fase);

      const etxeL=/larraun/i.test(p.etxekoa||"");
      const kanpoL=/larraun/i.test(p.kanpokoak||"");

      html+=`
        <div class="partido">
          <div class="linea1">
            <div class="zkia">${p.zkia}</div>
            <div class="lehiaketa">
              ${base}
              ${fase?`<div class="fase">${fase}</div>`:""}
            </div>
          </div>

          <div class="linea2">
            <div class="equipo azul ${etxeL?'larraun':''}">
              ${p.etxekoa||""}
            </div>
            <div class="equipo rojo ${kanpoL?'larraun':''}">
              ${p.kanpokoak||""}
            </div>
          </div>
        </div>
      `;
    });

    html+=`</div>`;
    cont.innerHTML+=html;
  });
});
</script>

</body>
</html>
