<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta property="og:image" content="https://larraunpilota.eus/preview-escritorio.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:title" content="Asteko Partiduak ‚Äì Larraun Pilota">
<meta property="og:description" content="Aste honetako partidu guztiak, ordutegiak eta frontoiak.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://larraunpilota.eus/asteko-kartela">

<title>Larraun ‚Äì Asteko Kartela</title>

<!-- html2canvas -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
body{
  margin:0;
  font-family: Arial, Helvetica, sans-serif;
  background:#e0e0e0;
}

/* ===== CARTEL ===== */
.cartel{
  position:relative;
  max-width:900px;
  margin:20px auto;
  background:#ffffffee;
  border-radius:12px;
  box-shadow:0 8px 20px rgba(0,0,0,.3);
  padding:20px 24px 30px;
  overflow:hidden;
}

/* FONDO FRONT√ìN */
.cartel::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    url("/images/fronton-wall.jpg") center/cover no-repeat;
  opacity:.12;
  filter:grayscale(100%) contrast(110%);
  z-index:0;
}

/* CONTENIDO REAL */
.cartel > *{
  position:relative;
  z-index:1;
}

/* ===== BOT√ìN JPG ===== */
.exportar{
  text-align:center;
  margin-bottom:14px;
}
.exportar button{
  background:#1b5e20;
  color:#fff;
  border:none;
  padding:10px 18px;
  font-size:.95em;
  border-radius:20px;
  cursor:pointer;
  box-shadow:0 3px 6px rgba(0,0,0,.3);
}
.exportar button:hover{
  background:#2e7d32;
}

/* ===== CABECERA ===== */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:16px;
}
.header img{height:64px;}
.header h1{
  margin:0;
  font-size:2em;
  letter-spacing:2px;
  color:#004d40;
}

/* ===== BLOQUES ===== */
.bloque{margin-top:26px;}
.bloque h2{
  margin:0 0 10px;
  font-size:1.4em;
  color:#1b5e20;
  border-bottom:3px solid #7cb342;
  padding-bottom:4px;
}

/* ===== GRUPO ===== */
.grupo{
  margin-top:14px;
  border-radius:8px;
  overflow:hidden;
  background:#ffffffdd;
  box-shadow:0 3px 8px rgba(0,0,0,.2);
}

.grupo-header{
  background:#e3f2fd;
  padding:10px 14px;
  font-weight:bold;
  color:#0d47a1;
}
.grupo-header.rojo{
  background:#f8d7da;
  color:#842029;
}
.grupo-header span{margin-right:14px;}

/* ===== LINEA PARTIDO ===== */
.linea{
  padding:8px 14px;
  border-top:1px solid #ddd;
  display:flex;
  gap:10px;
  font-size:.95em;
}

.zkia{
  width:26px;
  font-weight:bold;
  color:#333;
}

.etxekoa{color:#0d47a1;font-weight:bold;}
.kanpokoa{color:#b71c1c;font-weight:bold;}

.larraun{
  text-transform:uppercase;
  font-size:1.05em;
}

.lehiaketa{
  margin-left:auto;
  text-align:right;
}

.fase{font-weight:bold;}
</style>
</head>

<body>

<div class="exportar">
  <button onclick="exportarJPG()">üì∏ DESKARGATU KARTELA (JPG)</button>
</div>

<div class="cartel" id="kartela">

  <div class="header">
    <img src="/images/logo-larraun.png">
    <h1>ASTEKO PARTIDUAK</h1>
    <img src="/images/logo-fnp.png">
  </div>

  <div id="content"></div>

</div>

<script>
function exportarJPG(){
  html2canvas(document.getElementById("kartela"),{
    scale:2,
    backgroundColor:"#ffffff"
  }).then(canvas=>{
    const link=document.createElement("a");
    link.download="asteko-partiduak.jpg";
    link.href=canvas.toDataURL("image/jpeg",0.95);
    link.click();
  });
}
</script>
<script>
function normalizaHora(h){
  return h ? h.slice(0,5) : "00:00";
}

function detectarFase(t){
  const fases=[
    "FINAL LAURDENAK",
    "FINAL AURREKOAK",
    "FINALA",
    "LIGAXKA",
    "KANPORAKETA",
    "KAMPORAKETA"
  ];
  for(const f of fases){
    if(t.toUpperCase().includes(f)) return f;
  }
  return "";
}

function limpiarLehiaketa(t,f){
  return f ? t.replace(new RegExp(f,"i"),"").trim() : t;
}

function ordenar(data){
  return data.sort((a,b)=>{
    if(a.fecha!==b.fecha) return a.fecha.localeCompare(b.fecha);
    if(normalizaHora(a.hora)!==normalizaHora(b.hora))
      return normalizaHora(a.hora).localeCompare(normalizaHora(b.hora));
    return (a.fronton||"").localeCompare(b.fronton||"");
  });
}

function agrupar(data){
  const g={};
  data.forEach(p=>{
    const key=`${p.fecha}|${normalizaHora(p.hora)}|${p.fronton}`;
    if(!g[key]) g[key]=[];
    g[key].push(p);
  });
  Object.values(g).forEach(arr=>{
    arr.sort((a,b)=>(a.zkia||0)-(b.zkia||0));
  });
  return g;
}

Promise.all([
  fetch("/data/cartelera-larraun.json").then(r=>r.json()),
  fetch("/data/partidos-no-oficiales.json").then(r=>r.json())
]).then(([oficiales,noOficiales])=>{

  const bloques = [
    {titulo:"ORDUTEGIAK", data:ordenar(oficiales)},
    {titulo:"BESTE TXAPELKETAK OFIZIALAK",
     data:ordenar(noOficiales.filter(p=>String(p.ofiziala).toLowerCase()==="true"))},
    {titulo:"TXAPELKETAK EZ OFIZIALAK",
     data:ordenar(noOficiales.filter(p=>String(p.ofiziala).toLowerCase()!=="true"))}
  ];

  const cont=document.getElementById("content");

  bloques.forEach(b=>{
    if(!b.data.length) return;

    const grupos=agrupar(b.data);
    cont.innerHTML+=`<div class="bloque"><h2>${b.titulo}</h2></div>`;
    const bloqueDiv=cont.lastChild;

    Object.values(grupos).forEach(partidos=>{
      const p0=partidos[0];
      const esLocal=/lekunberri|aldatz/i.test(p0.fronton||"");

      bloqueDiv.innerHTML+=`
        <div class="grupo">
          <div class="grupo-header ${!esLocal?'rojo':''}">
            <span>üìÖ ${p0.fecha}</span>
            <span>‚è∞ ${normalizaHora(p0.hora)}</span>
            <span>üìç ${p0.fronton}</span>
          </div>

          ${partidos.map(p=>{
            const textoEquipos=(p.etxekoa||"")+" "+(p.kanpokoak||"");
            const doble=textoEquipos.length>60;
            const fase=detectarFase(p.lehiaketa||"");
            const lehiaketaLimpia=limpiarLehiaketa(p.lehiaketa||"",fase);

            return `
            <div class="linea">
              <div class="zkia">${p.zkia}</div>

              <div class="equipos">
                <div class="fila1">
                  <div class="etxekoa ${/larraun/i.test(p.etxekoa||"")?'larraun':''}">
                    ${p.etxekoa||""}
                  </div>
                </div>
                ${doble?`
                <div class="fila2">
                  <div class="kanpokoa ${/larraun/i.test(p.kanpokoak||"")?'larraun':''}">
                    ${p.kanpokoak||""}
                  </div>
                </div>`:
                `<div class="fila1">
                  <div class="kanpokoa ${/larraun/i.test(p.kanpokoak||"")?'larraun':''}">
                    ${p.kanpokoak||""}
                  </div>
                </div>`}
              </div>

              <div class="lehiaketa">
                ${lehiaketaLimpia}
                ${fase?` <span class="fase">(${fase})</span>`:""}
              </div>
            </div>`;
          }).join("")}

        </div>`;
    });
  });
});
</script>

</body>
</html>
