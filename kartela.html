<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta property="og:image" content="https://larraunpilota.eus/preview-escritorio.jpg">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:title" content="Asteko Partiduak ‚Äì Larraun Pilota">
<meta property="og:description" content="Aste honetako partidu guztiak, ordutegiak eta frontoiak.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://larraunpilota.eus/asteko-kartela">

<title>Larraun ‚Äì Asteko Kartela</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
/* ======================================================
   BASE
====================================================== */
body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:#e4efe8;
}

/* ======================================================
   CARTEL = PARED DE FRONT√ìN VERDE
====================================================== */
.cartel{
  position:relative;
  max-width:900px;
  margin:20px auto;
  padding:20px 24px 30px;
  border-radius:14px;
  overflow:hidden;

  /* verde front√≥n */
  background-color:#dfeee4;

  /* textura + grano + pelotazos m√°s visibles */
  background-image:
    radial-gradient(rgba(0,0,0,.07) 1px, transparent 1px),
    radial-gradient(rgba(0,0,0,.05) 1px, transparent 1px),

    /* pelotazos grandes */
    radial-gradient(ellipse 32px 24px at 20% 30%, rgba(0,0,0,.25), transparent 70%),
    radial-gradient(ellipse 40px 30px at 70% 60%, rgba(0,0,0,.22), transparent 70%),
    radial-gradient(ellipse 26px 20px at 40% 80%, rgba(0,0,0,.20), transparent 70%),
    radial-gradient(ellipse 36px 26px at 80% 20%, rgba(0,0,0,.18), transparent 70%);

  background-size:
    18px 18px,
    26px 26px,
    700px 700px,
    900px 900px,
    650px 650px,
    800px 800px;

  box-shadow:0 10px 28px rgba(0,0,0,.35);
}

/* ======================================================
   BOT√ìN
====================================================== */
.exportar{
  text-align:center;
  margin:14px 0;
}
.exportar button{
  background:#1b5e20;
  color:#fff;
  border:none;
  padding:10px 18px;
  border-radius:20px;
  cursor:pointer;
  box-shadow:0 3px 6px rgba(0,0,0,.3);
}
.exportar button:hover{
  background:#2e7d32;
}

/* ======================================================
   CABECERA
====================================================== */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:16px;
}
.header img{height:64px;}
.header h1{
  margin:0;
  font-size:2em;
  letter-spacing:2px;
  color:#004d40;
}

/* ======================================================
   BLOQUES (T√çTULOS CENTRADOS)
====================================================== */
.bloque{margin-top:28px;}

.bloque h2{
  text-align:center;              /* ‚Üê centrado */
  margin:0 0 14px;
  font-size:1.45em;
  color:#1b5e20;
  font-weight:800;
  letter-spacing:1px;
}

/* ======================================================
   GRUPO = CARTEL PEGADO A LA PARED
====================================================== */
.grupo{
  position:relative;
  margin-top:14px;

  background:#ffffffee;

  border-radius:10px;

  /* efecto papel pegado */
  box-shadow:
    0 4px 10px rgba(0,0,0,.25),
    0 1px 0 rgba(255,255,255,.6) inset;

  backdrop-filter:blur(2px);
}

/* peque√±as marcas tambi√©n sobre el papel */
.grupo::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  opacity:.18;
  background:
    radial-gradient(circle at 30% 20%, #000 2px, transparent 3px),
    radial-gradient(circle at 60% 70%, #000 2px, transparent 3px);
}

/* ======================================================
   CABECERA GRUPO
====================================================== */
.grupo-header{
  background:#e3f2fd;
  padding:10px 14px;
  font-weight:bold;
  color:#0d47a1;
}
.grupo-header.rojo{
  background:#f8d7da;
  color:#842029;
}

/* ======================================================
   PARTIDOS
====================================================== */
.linea{
  padding:8px 14px;
  border-top:1px solid #ddd;
  display:flex;
  gap:10px;
  font-size:.95em;
}

.zkia{
  width:26px;
  font-weight:bold;
  color:#333;
}

.etxekoa{color:#0d47a1;font-weight:bold;}
.kanpokoa{color:#b71c1c;font-weight:bold;}

.larraun{
  text-transform:uppercase;
  font-size:1.05em;
}

.lehiaketa{
  margin-left:auto;
  text-align:right;
}

.fase{font-weight:bold;}
</style>
</head>

<body>

<div class="exportar">
  <button onclick="exportarJPG()">üì∏ DESKARGATU KARTELA (JPG)</button>
</div>

<div class="cartel" id="kartela">

  <div class="header">
    <img src="/images/logo-larraun.png">
    <h1>LARRAUN PILOTA ELKARTEA</h1>
    <img src="/images/logo-fnp.png">
  </div>

  <div id="content"></div>

</div>

<script>
function exportarJPG(){
  html2canvas(document.getElementById("kartela"),{
    scale:2,
    backgroundColor:"#ffffff"
  }).then(canvas=>{
    const link=document.createElement("a");
    link.download="asteko-partiduak.jpg";
    link.href=canvas.toDataURL("image/jpeg",0.95);
    link.click();
  });
}
</script>
function normalizaHora(h){
  return h ? h.slice(0,5) : "00:00";
}

function detectarFase(t){
  const fases=[
    "FINAL LAURDENAK",
    "FINAL AURREKOAK",
    "FINALA",
    "LIGAXKA",
    "KANPORAKETA",
    "KAMPORAKETA"
  ];
  for(const f of fases){
    if(t.toUpperCase().includes(f)) return f;
  }
  return "";
}

function limpiarLehiaketa(t,f){
  return f ? t.replace(new RegExp(f,"i"),"").trim() : t;
}

function ordenar(data){
  return data.sort((a,b)=>{
    if(a.fecha!==b.fecha) return a.fecha.localeCompare(b.fecha);
    if(normalizaHora(a.hora)!==normalizaHora(b.hora))
      return normalizaHora(a.hora).localeCompare(normalizaHora(b.hora));
    return (a.fronton||"").localeCompare(b.fronton||"");
  });
}

function agrupar(data){
  const g={};
  data.forEach(p=>{
    const key=`${p.fecha}|${normalizaHora(p.hora)}|${p.fronton}`;
    if(!g[key]) g[key]=[];
    g[key].push(p);
  });
  Object.values(g).forEach(arr=>{
    arr.sort((a,b)=>(a.zkia||0)-(b.zkia||0));
  });
  return g;
}

Promise.all([
  fetch("/data/cartelera-larraun.json").then(r=>r.json()),
  fetch("/data/partidos-no-oficiales.json").then(r=>r.json())
]).then(([oficiales,noOficiales])=>{

  const bloques = [
    {titulo:"ORDUTEGIAK", data:ordenar(oficiales)},
    {titulo:"BESTE TXAPELKETAK OFIZIALAK",
     data:ordenar(noOficiales.filter(p=>String(p.ofiziala).toLowerCase()==="true"))},
    {titulo:"TXAPELKETAK EZ OFIZIALAK",
     data:ordenar(noOficiales.filter(p=>String(p.ofiziala).toLowerCase()!=="true"))}
  ];

  const cont=document.getElementById("content");

  bloques.forEach(b=>{
    if(!b.data.length) return;

    const grupos=agrupar(b.data);
    cont.innerHTML+=`<div class="bloque"><h2>${b.titulo}</h2></div>`;
    const bloqueDiv=cont.lastChild;

    Object.values(grupos).forEach(partidos=>{
      const p0=partidos[0];
      const esLocal=/lekunberri|aldatz/i.test(p0.fronton||"");

      bloqueDiv.innerHTML+=`
        <div class="grupo">
          <div class="grupo-header ${!esLocal?'rojo':''}">
            <span>üìÖ ${p0.fecha}</span>
            <span>‚è∞ ${normalizaHora(p0.hora)}</span>
            <span>üìç ${p0.fronton}</span>
          </div>

          ${partidos.map(p=>`
            <div class="linea">
              <div class="zkia">${p.zkia}</div>
              <div class="etxekoa">${p.etxekoa||""}</div>
              <div class="kanpokoa">${p.kanpokoak||""}</div>
              <div class="lehiaketa">${p.lehiaketa||""}</div>
            </div>
          `).join("")}
        </div>`;
    });
  });
});
</script>

</body>
</html>
