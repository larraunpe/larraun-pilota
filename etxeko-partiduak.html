<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<title>Etxeko partiduak ‚Äì Larraun Pilota</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: Arial, Helvetica, sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:20px;
}

header{
  text-align:center;
  margin-bottom:20px;
}

header img{
  max-width:140px;
  margin-bottom:10px;
}

h1{
  margin:0;
  color:#004d40;
}

#content{
  max-width:900px;
  margin:auto;
}

/* ===== SEPARADOR D√çA ===== */
.day-separator{
  margin:34px 0 16px;
  text-align:center;
  font-weight:900;
  color:#444;
  letter-spacing:1px;
}

/* ===== GRUPOS ===== */
.group{
  margin-bottom:22px;
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 3px 8px rgba(0,0,0,.2);
}

/* No oficiales */
.no-oficial{
  background: repeating-linear-gradient(
    45deg,
    rgba(0,0,0,0.03),
    rgba(0,0,0,0.03) 10px,
    rgba(0,0,0,0.07) 10px,
    rgba(0,0,0,0.07) 20px
  );
}

/* ===== CABECERA BLOQUE ===== */
.group-header{
  padding:14px 18px;
  color:#fff;
}

.fronton-jai-alai .group-header{ background:#1565c0; }
.fronton-trinkete .group-header{ background:#ad1457; }

.lekunberri .group-header{ box-shadow: inset 0 0 0 4px #1b5e20; }
.aldatz .group-header{ box-shadow: inset 0 0 0 4px #4e342e; }

.fronton-name{
  font-size:1.25em;
  font-weight:900;
}

.datetime{
  font-size:1em;
  opacity:.95;
}

/* ===== CONTENIDO ===== */
.group-body{
  background:#fff;
  padding:16px 18px;
}

.match{
  padding-top:12px;
  margin-top:12px;
  border-top:1px solid rgba(0,0,0,.15);
}

.torneo{
  font-size:1.1em;
  font-weight:900;
  margin-bottom:6px;
}

.etxekoa{
  color:#0d47a1;
  font-weight:700;
}

.kanpokoa{
  color:#b71c1c;
  font-weight:700;
}
</style>
</head>

<body>

<header>
  <img src="/img/logo-larraun.png" alt="Larraun Pilota">
  <h1>Etxeko partiduak</h1>
</header>

<div id="content"></div>

<script>
/* ================= CONFIG ================= */
const SOURCES = [
  { url: "/data/resultados-larraun.json", ofiziala: true },
  { url: "/data/resultados-no-oficiales.json", ofiziala: false }
];

/* ================= HELPERS ================= */
function getHora(m){
  return m.hora || m.ordua || "";
}

function getTorneo(m){
  return m.modalidad || m.torneo || m.txapelketa || "";
}

function parseDate(m){
  return new Date(m.fecha + "T" + (getHora(m) || "00:00"));
}

function mondayOfWeek(d){
  const x = new Date(d);
  const day = x.getDay() || 7;
  if(day !== 1) x.setDate(x.getDate() - day + 1);
  x.setHours(0,0,0,0);
  return x;
}

function groupKey(m){
  return `${m.fronton}|${m.fecha}|${getHora(m)}`;
}

function frontonClass(f){
  return /trinkete/i.test(f) ? "fronton-trinkete" : "fronton-jai-alai";
}

function lugarClass(f){
  if(/lekunberri/i.test(f)) return "lekunberri";
  if(/aldatz/i.test(f)) return "aldatz";
  return "";
}

function esLarraun(f){
  return /lekunberri|aldatz/i.test(f || "");
}

function dayLabelEU(date){
  const days = ["IGANDEA","ASTELEHENA","ASTEARTEA","ASTEAZKENA","OSTEGUNA","OSTIRALA","LARUNBATA"];
  const months = ["URTARRILA","OTSAILA","MARTXOA","APIRILA","MAIATZA","EKAINA","UZTAILA","ABUZTUA","IRAILA","URRIA","AZAROA","ABENDUA"];
  return `${days[date.getDay()]} ¬∑ ${date.getDate()} ${months[date.getMonth()]}`;
}

/* ================= LOAD DATA ================= */
Promise.all(
  SOURCES.map(s =>
    fetch(s.url)
      .then(r => r.json())
      .then(arr => arr.map(m => ({ ...m, ofiziala: s.ofiziala })))
  )
).then(all => {

  const today = new Date();
  today.setHours(0,0,0,0);

  const mon = mondayOfWeek(today);
  const sun = new Date(mon);
  sun.setDate(mon.getDate() + 6);

  let data = all.flat().filter(m => {
    if(!esLarraun(m.fronton)) return false;
    const d = parseDate(m);
    return d >= mon && d <= sun;
  });

  data.sort((a,b)=> parseDate(a) - parseDate(b));

  const container = document.getElementById("content");
  let lastDay = "";

  data.forEach(m => {
    const d = parseDate(m);
    const dayKey = d.toDateString();

    if(dayKey !== lastDay){
      container.innerHTML += `<div class="day-separator">‚Äî ${dayLabelEU(d)} ‚Äî</div>`;
      lastDay = dayKey;
    }

    const key = groupKey(m);
    if(document.getElementById(key)) return;

    const matches = data.filter(x => groupKey(x) === key);
    const m0 = matches[0];

    const group = document.createElement("div");
    group.id = key;
    group.className = `group ${frontonClass(m0.fronton)} ${lugarClass(m0.fronton)}`;
    if(!m0.ofiziala) group.classList.add("no-oficial");

    group.innerHTML = `
      <div class="group-header">
        <div class="fronton-name">üìç ${m0.fronton}</div>
        <div class="datetime">üìÖ ${m0.fecha} ¬∑ ‚è∞ ${getHora(m0)}</div>
      </div>
      <div class="group-body"></div>
    `;

    const body = group.querySelector(".gr
