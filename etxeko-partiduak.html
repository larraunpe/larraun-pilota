<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<title>Etxeko partiduak ‚Äì Larraun Pilota</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: Arial, Helvetica, sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:20px;
}

h1{
  text-align:center;
  color:#004d40;
}

#content{
  max-width:900px;
  margin:auto;
}

/* ===== GRUPOS ===== */
.group{
  margin-bottom:22px;
  padding:14px;
  border-radius:12px;
  background:#fff;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}

/* No oficiales */
.no-oficial{
  opacity:.85;
  background: repeating-linear-gradient(
    45deg,
    rgba(0,0,0,0.03),
    rgba(0,0,0,0.03) 10px,
    rgba(0,0,0,0.06) 10px,
    rgba(0,0,0,0.06) 20px
  );
}

/* Front√≥n / Trinkete */
.fronton-jai-alai{ background:#e3f2fd; }
.fronton-trinkete{ background:#fce4ec; }

/* Lekunberri / Aldatz */
.lekunberri{ box-shadow: inset 0 0 0 4px #1b5e20; }
.aldatz{ box-shadow: inset 0 0 0 4px #4e342e; }

/* ===== CABECERA ===== */
.fronton{
  font-size:1.15em;
  font-weight:800;
  color:#004d40;
}

.datetime{
  font-size:.9em;
  color:#333;
}

/* ===== PARTIDOS ===== */
.match{
  margin-top:12px;
  padding-top:10px;
  border-top:1px solid rgba(0,0,0,.15);
}

.torneo{
  font-size:1.05em;
  font-weight:800;
}

.etxekoa{
  color:#0d47a1;
  font-weight:600;
}

.kanpokoa{
  color:#b71c1c;
  font-weight:600;
}
</style>
</head>

<body>

<h1>Etxeko partiduak (aste honetakoak)</h1>

<div id="content"></div>

<script>
// ================= CONFIG =================
const SOURCES = [
  { url: "/data/resultados-larraun.json", ofiziala: true },
  { url: "/data/resultados-no-oficiales.json", ofiziala: false }
];

// ================= HELPERS =================
function parseDate(m){
  return new Date(m.fecha + "T" + (m.ordua || "00:00"));
}

function mondayOfWeek(d){
  const x = new Date(d);
  const day = x.getDay() || 7;
  if(day !== 1) x.setDate(x.getDate() - day + 1);
  x.setHours(0,0,0,0);
  return x;
}

function groupKey(m){
  return `${m.fronton}|${m.fecha}|${m.ordua}`;
}

function frontonClass(f){
  return /trinkete/i.test(f) ? "fronton-trinkete" : "fronton-jai-alai";
}

function lugarClass(f){
  if(/lekunberri/i.test(f)) return "lekunberri";
  if(/aldatz/i.test(f)) return "aldatz";
  return "";
}

function esLarraun(f){
  return /lekunberri|aldatz/i.test(f || "");
}

// ================= LOAD DATA =================
Promise.all(
  SOURCES.map(s =>
    fetch(s.url)
      .then(r => r.json())
      .then(arr => arr.map(m => ({ ...m, ofiziala: s.ofiziala })))
  )
).then(all => {

  const today = new Date();
  today.setHours(0,0,0,0);

  const mon = mondayOfWeek(today);
  const sun = new Date(mon);
  sun.setDate(mon.getDate() + 6);

  let data = all.flat();

  // üëâ FILTROS IMPORTANTES
  data = data.filter(m => {
    if(!esLarraun(m.fronton)) return false;

    const d = parseDate(m);
    return d >= mon && d <= sun;
  });

  // ORDENAR: d√≠a ‚Üí hora ‚Üí front√≥n
  data.sort((a,b)=>{
    const da = parseDate(a);
    const db = parseDate(b);
    if(da - db !== 0) return da - db;
    return (a.fronton || "").localeCompare(b.fronton || "");
  });

  // AGRUPAR
  const groups = {};
  data.forEach(m=>{
    const key = groupKey(m);
    if(!groups[key]) groups[key] = [];
    groups[key].push(m);
  });

  const container = document.getElementById("content");

  // RENDER
  Object.values(groups).forEach(matches=>{
    const m0 = matches[0];

    const group = document.createElement("div");
    group.className = `group ${frontonClass(m0.fronton)} ${lugarClass(m0.fronton)}`;
    if(!m0.ofiziala) group.classList.add("no-oficial");

    group.innerHTML = `
      <div class="fronton">üìç ${m0.fronton}</div>
      <div class="datetime">üìÖ ${m0.fecha} ¬∑ ‚è∞ ${m0.ordua}</div>
    `;

    matches.forEach((m,i)=>{
      group.innerHTML += `
        <div class="match">
          <div class="torneo">${i+1} ¬∑ ${m.modalidad || ""}</div>
          <div class="etxekoa">üè† ${m.etxekoa || ""}</div>
          <div class="kanpokoa">‚úàÔ∏è ${m.kanpokoak || ""}</div>
        </div>
      `;
    });

    container.appendChild(group);
  });
});
</script>

</body>
</html>
