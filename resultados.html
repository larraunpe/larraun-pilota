<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emaitzak – Larraun Pilota</title>

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:20px;
}

h2 {
  margin-top:40px;
  color:#222;
}

.week-block {
  margin-bottom:40px;
}

.match {
  margin-bottom:14px;
  padding:14px 16px;
  border-radius:8px;
  color:#222;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
  font-size:0.95em;
}

/* ===== RAYAS ===== */
.win.home.official {
  background: repeating-linear-gradient(
    45deg,
    #dff3e4,
    #dff3e4 10px,
    #e3ecf7 10px,
    #e3ecf7 20px
  );
}

.win.away.official {
  background: repeating-linear-gradient(
    45deg,
    #dff3e4,
    #dff3e4 10px,
    #eeeeee 10px,
    #eeeeee 20px
  );
}

.lose.home.official {
  background: repeating-linear-gradient(
    45deg,
    #f6d6d6,
    #f6d6d6 10px,
    #e3ecf7 10px,
    #e3ecf7 20px
  );
}

.lose.away.official {
  background: repeating-linear-gradient(
    45deg,
    #f6d6d6,
    #f6d6d6 10px,
    #eeeeee 10px,
    #eeeeee 20px
  );
}

/* NO OFICIALES → rayas invertidas */
.no-oficial.win.home {
  background: repeating-linear-gradient(
    -45deg,
    #dff3e4,
    #dff3e4 10px,
    #e3ecf7 10px,
    #e3ecf7 20px
  );
}

.no-oficial.win.away {
  background: repeating-linear-gradient(
    -45deg,
    #dff3e4,
    #dff3e4 10px,
    #eeeeee 10px,
    #eeeeee 20px
  );
}

.no-oficial.lose.home {
  background: repeating-linear-gradient(
    -45deg,
    #f6d6d6,
    #f6d6d6 10px,
    #e3ecf7 10px,
    #e3ecf7 20px
  );
}

.no-oficial.lose.away {
  background: repeating-linear-gradient(
    -45deg,
    #f6d6d6,
    #f6d6d6 10px,
    #eeeeee 10px,
    #eeeeee 20px
  );
}

.team {
  font-weight:bold;
}

.score {
  margin-top:6px;
  font-size:1.05em;
}

.sets {
  font-size:0.9em;
  margin-top:4px;
  color:#444;
}

.place {
  font-style:italic;
  margin-top:4px;
}
</style>
</head>

<body>

<h1>Emaitzak</h1>
<div id="results"></div>

<script>
function getDateRangeSemanaActualYAnterior() {
  const today = new Date();
  today.setHours(0,0,0,0);
  const day = today.getDay();
  const diffToMonday = day === 0 ? -6 : 1 - day;

  const mondayThisWeek = new Date(today);
  mondayThisWeek.setDate(today.getDate() + diffToMonday);

  const mondayLastWeek = new Date(mondayThisWeek);
  mondayLastWeek.setDate(mondayThisWeek.getDate() - 7);

  const sundayThisWeek = new Date(mondayThisWeek);
  sundayThisWeek.setDate(mondayThisWeek.getDate() + 6);

  return { from: mondayLastWeek, to: sundayThisWeek };
}

function parseFecha(str) {
  if (!str) return null;
  const [y,m,d] = str.split("-");
  const date = new Date(y, m-1, d);
  date.setHours(0,0,0,0);
  return date;
}

function hasValidResult(p) {
  if (!p || !p.resultado) return false;
  if (String(p.resultado).toLowerCase().includes("descanso")) return false;
  return true;
}

function formatSets(sets) {
  if (!Array.isArray(sets)) return "";
  return sets.map(s =>
    s.match(/\d+-\d+/g)?.join("  ")
  ).join(" | ");
}

function isHome(place) {
  if (!place) return false;
  const p = place.toLowerCase();
  return p.includes("lekunberri") || p.includes("aldatz");
}

fetch("/data/resultados-larraun.json")
.then(r => r.json())
.then(data => {
  const { from, to } = getDateRangeSemanaActualYAnterior();

  const filtered = data.filter(p => {
    if (!hasValidResult(p)) return false;
    const d = parseFecha(p.fecha);
    if (!d) return false;
    return d >= from && d <= to;
  });

  const weeks = {};

  filtered.forEach(p => {
    const d = parseFecha(p.fecha);
    const weekKey = d.toISOString().slice(0,10);
    if (!weeks[weekKey]) weeks[weekKey] = [];
    weeks[weekKey].push(p);
  });

  const container = document.getElementById("results");

  Object.keys(weeks).sort((a,b)=>b.localeCompare(a)).forEach(week => {
    const block = document.createElement("div");
    block.className = "week-block";

    block.innerHTML = `<h2>${week} asteko emaitzak</h2>`;

    weeks[week].forEach(p => {
      const win = p.gana ? "win" : "lose";
      const home = isHome(p.frontoia) ? "home" : "away";
      const official = p.ofiziala ? "official" : "no-oficial";

      const div = document.createElement("div");
      div.className = `match ${win} ${home} ${official}`;

      div.innerHTML = `
        <div class="team">${p.etxekoa} – ${p.kanpokoak}</div>
        <div class="score">${p.resultado}</div>
        <div class="sets">${formatSets(p.sets)}</div>
        <div class="place">${p.frontoia}</div>
      `;

      block.appendChild(div);
    });

    container.appendChild(block);
  });
});
</script>

</body>
</html>
