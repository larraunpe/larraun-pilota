<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<title>Larraun – Emaitzak</title>

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:20px;
}

h2 {
  margin-top:30px;
  color:#222;
}

.week-title {
  margin:30px 0 12px;
  font-size:1.4em;
  font-weight:bold;
  color:#006400;
}

/* ===== PARTIDO ===== */
.match {
  background:#fff;
  margin-bottom:14px;
  padding:14px 18px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
  position:relative;
  overflow:hidden;
}

.match.no-oficial::after {
  content:"EZ OFIZIALA";
  position:absolute;
  top:10px;
  right:-40px;
  transform:rotate(45deg);
  background:#b00000;
  color:#fff;
  padding:4px 50px;
  font-size:0.75em;
  font-weight:bold;
}

/* ===== FRANJAS ===== */
.win-home {
  background:
    repeating-linear-gradient(
      -45deg,
      rgba(0,100,0,0.15),
      rgba(0,100,0,0.15) 10px,
      rgba(0,80,150,0.15) 10px,
      rgba(0,80,150,0.15) 20px
    );
}

.win-away {
  background:
    repeating-linear-gradient(
      -45deg,
      rgba(0,100,0,0.15),
      rgba(0,100,0,0.15) 10px,
      rgba(120,120,120,0.15) 10px,
      rgba(120,120,120,0.15) 20px
    );
}

.lose-home {
  background:
    repeating-linear-gradient(
      -45deg,
      rgba(160,0,0,0.15),
      rgba(160,0,0,0.15) 10px,
      rgba(0,80,150,0.15) 10px,
      rgba(0,80,150,0.15) 20px
    );
}

.lose-away {
  background:
    repeating-linear-gradient(
      -45deg,
      rgba(160,0,0,0.15),
      rgba(160,0,0,0.15) 10px,
      rgba(120,120,120,0.15) 10px,
      rgba(120,120,120,0.15) 20px
    );
}

/* no oficiales: franjas al revés */
.no-oficial.win-home,
.no-oficial.win-away,
.no-oficial.lose-home,
.no-oficial.lose-away {
  background-size:20px 20px;
  background-image:
    repeating-linear-gradient(
      45deg,
      rgba(0,0,0,0.08),
      rgba(0,0,0,0.08) 10px,
      rgba(255,255,255,0.08) 10px,
      rgba(255,255,255,0.08) 20px
    );
}

.line {
  margin:4px 0;
}

.teams {
  font-weight:bold;
}

.score {
  font-size:1.05em;
  font-weight:bold;
}

.meta {
  font-size:0.9em;
  color:#333;
}
</style>
</head>

<body>

<div id="content"></div>

<script>
const DATA_URL = "/data/resultados-larraun.json";

function parseDate(d) {
  return new Date(d + "T00:00:00");
}

function mondayOfWeek(date) {
  const d = new Date(date);
  const day = d.getDay() || 7;
  if (day !== 1) d.setDate(d.getDate() - day + 1);
  return d;
}

function inRange(date, start, end) {
  return date >= start && date <= end;
}

function isHome(fronton) {
  return /lekunberri|aldatz/i.test(fronton);
}

fetch(DATA_URL)
  .then(r => r.json())
  .then(data => {
    const today = new Date();
    const thisMonday = mondayOfWeek(today);
    const lastMonday = new Date(thisMonday);
    lastMonday.setDate(thisMonday.getDate() - 7);
    const lastSunday = new Date(thisMonday);
    lastSunday.setDate(thisMonday.getDate() - 1);

    const weekThis = [];
    const weekLast = [];

    data.forEach(m => {
      if (!m.emaitza || m.emaitza === "undefined") return;

      const d = parseDate(m.fecha);

      if (inRange(d, thisMonday, today)) {
        weekThis.push(m);
      } else if (inRange(d, lastMonday, lastSunday)) {
        weekLast.push(m);
      }
    });

    const container = document.getElementById("content");

    function renderWeek(title, matches) {
      if (!matches.length) return;

      container.innerHTML += `<div class="week-title">${title}</div>`;

      matches.forEach(m => {
        const home = isHome(m.fronton);
        const win = m.emaitza === "irabazita";
        const oficial = m.ofiziala !== false;

        let cls = "match ";
        cls += oficial ? "" : "no-oficial ";
        cls += win
          ? (home ? "win-home" : "win-away")
          : (home ? "lose-home" : "lose-away");

        container.innerHTML += `
          <div class="${cls}">
            <div class="line meta">${m.fecha} · ${m.fronton}</div>
            <div class="line teams">${m.etxekoa} vs ${m.kanpokoak}</div>
            <div class="line score">${m.tanteoa || ""}</div>
            ${m.sets && m.sets.length ? `<div class="line meta">${m.sets.join("  ")}</div>` : ""}
            <div class="line meta">${m.modalidad || ""}</div>
          </div>
        `;
      });
    }

    renderWeek("ASTE HONETAKO EMAITZAK", weekThis);
    renderWeek("AURREKO ASTEKO EMAITZAK", weekLast);
  });
</script>

</body>
</html>
