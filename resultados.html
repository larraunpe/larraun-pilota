<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<title>Larraun ‚Äì Emaitzak</title>

<style>
body{
  font-family:Arial,Helvetica,sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:20px;
}

.week-title{
  margin:30px 0 10px;
  font-size:1.4em;
  font-weight:bold;
  color:#004d40;
}

/* ===== TARJETA ===== */
.match{
  background:#fff;
  margin-bottom:14px;
  padding:14px 18px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
  position:relative;
  overflow:hidden;
}

.match.no-oficial::after{
  content:"EZ OFIZIALA";
  position:absolute;
  top:12px;
  right:-42px;
  transform:rotate(45deg);
  background:#b00000;
  color:#fff;
  padding:4px 55px;
  font-size:.75em;
  font-weight:bold;
}

/* ===== FRANJAS ===== */
.win-home{
  background:repeating-linear-gradient(
    -45deg,
    rgba(0,100,0,.15),
    rgba(0,100,0,.15) 10px,
    rgba(0,80,150,.15) 10px,
    rgba(0,80,150,.15) 20px
  );
}
.win-away{
  background:repeating-linear-gradient(
    -45deg,
    rgba(0,100,0,.15),
    rgba(0,100,0,.15) 10px,
    rgba(120,120,120,.15) 10px,
    rgba(120,120,120,.15) 20px
  );
}
.lose-home{
  background:repeating-linear-gradient(
    -45deg,
    rgba(160,0,0,.15),
    rgba(160,0,0,.15) 10px,
    rgba(0,80,150,.15) 10px,
    rgba(0,80,150,.15) 20px
  );
}
.lose-away{
  background:repeating-linear-gradient(
    -45deg,
    rgba(160,0,0,.15),
    rgba(160,0,0,.15) 10px,
    rgba(120,120,120,.15) 10px,
    rgba(120,120,120,.15) 20px
  );
}

/* no oficiales ‚Üí franjas inversas */
.no-oficial.win-home,
.no-oficial.win-away,
.no-oficial.lose-home,
.no-oficial.lose-away{
  background-image:repeating-linear-gradient(
    45deg,
    rgba(0,0,0,.08),
    rgba(0,0,0,.08) 10px,
    rgba(255,255,255,.08) 10px,
    rgba(255,255,255,.08) 20px
  );
}

.line{margin:4px 0;}
.teams{font-weight:bold;}
.score{font-size:1.1em;font-weight:bold;}
.meta{font-size:.9em;color:#333;}
.icon{margin-right:6px;}
</style>
</head>

<body>

<div id="content"></div>

<script>
const URLS = [
  { url:"/data/resultados-larraun.json", oficial:true },
  { url:"/data/resultados-no-oficiales.json", oficial:false }
];

function parseDate(d){ return new Date(d+"T00:00:00"); }

function mondayOfWeek(date){
  const d=new Date(date);
  const day=d.getDay()||7;
  if(day!==1)d.setDate(d.getDate()-day+1);
  return d;
}

function isHome(fronton){
  return /lekunberri|aldatz/i.test(fronton);
}

Promise.all(
  URLS.map(src =>
    fetch(src.url)
      .then(r=>r.json())
      .then(arr=>arr.map(o=>({ ...o, ofiziala:src.oficial })))
  )
).then(all=>{
  const data = all.flat();

  const today=new Date();
  const thisMon=mondayOfWeek(today);
  const lastMon=new Date(thisMon); lastMon.setDate(thisMon.getDate()-7);
  const lastSun=new Date(thisMon); lastSun.setDate(thisMon.getDate()-1);

  const thisWeek=[], lastWeek=[];

  data.forEach(m=>{
    if(!m.emaitza||m.emaitza==="undefined")return;
    const d=parseDate(m.fecha);
    if(d>=thisMon&&d<=today)thisWeek.push(m);
    else if(d>=lastMon&&d<=lastSun)lastWeek.push(m);
  });

  const container=document.getElementById("content");

  function render(title,arr){
    if(!arr.length)return;
    container.innerHTML+=`<div class="week-title">${title}</div>`;
    arr.forEach(m=>{
      const home=isHome(m.fronton);
      const win=m.emaitza==="irabazita";
      let cls="match ";
      if(!m.ofiziala)cls+="no-oficial ";
      cls+=win?(home?"win-home":"win-away"):(home?"lose-home":"lose-away");

      container.innerHTML+=`
      <div class="${cls}">
        <div class="line meta"><span class="icon">üìÖ</span>${m.fecha}</div>
        <div class="line meta"><span class="icon">üìç</span>${m.fronton}</div>
        <div class="line teams"><span class="icon">üè†</span>${m.etxekoa}</div>
        <div class="line teams"><span class="icon">‚úàÔ∏è</span>${m.kanpokoak}</div>
        <div class="line score">${m.tanteoa||""}</div>
        ${m.sets?.length?`<div class="line meta">${m.sets.join("  ")}</div>`:""}
        <div class="line meta"><span class="icon">üèÜ</span>${m.modalidad||""}</div>
      </div>`;
    });
  }

  render("ASTE HONETAKO EMAITZAK", thisWeek);
  render("AURREKO ASTEKO EMAITZAK", lastWeek);
});
</script>

</body>
</html>
