<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<title>Larraun ‚Äì Emaitzak</title>

<style>
body{
  font-family:Arial,Helvetica,sans-serif;
  background:#f4f4f4;
  margin:0;
}

header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 20px;
  background:#fff;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}
header img{height:50px;}
header h1{
  margin:0;
  font-size:2em;
  color:#004d40;
  letter-spacing:2px;
}

main{padding:20px;}

.week-title{
  margin:36px 0 14px;
  font-size:1.4em;
  font-weight:bold;
  color:#004d40;
}

.match{
  background:#fff;
  margin-bottom:16px;
  padding:14px 18px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
  position:relative;
  overflow:hidden;
}

.match.no-oficial::after{
  content:"EZ OFIZIALA";
  position:absolute;
  top:12px;
  right:-45px;
  transform:rotate(45deg);
  background:#b00000;
  color:#fff;
  padding:4px 60px;
  font-size:.75em;
  font-weight:bold;
}

/* Franjas */
.win-home{background:repeating-linear-gradient(-45deg,rgba(0,100,0,.18) 0 12px,rgba(0,90,160,.18) 12px 24px);}
.win-away{background:repeating-linear-gradient(-45deg,rgba(0,100,0,.18) 0 12px,rgba(140,140,140,.18) 12px 24px);}
.lose-home{background:repeating-linear-gradient(-45deg,rgba(170,0,0,.18) 0 12px,rgba(0,90,160,.18) 12px 24px);}
.lose-away{background:repeating-linear-gradient(-45deg,rgba(170,0,0,.18) 0 12px,rgba(140,140,140,.18) 12px 24px);}

.no-oficial.win-home,
.no-oficial.win-away,
.no-oficial.lose-home,
.no-oficial.lose-away{
  background-image:repeating-linear-gradient(45deg,rgba(0,0,0,.1) 0 12px,rgba(255,255,255,.1) 12px 24px);
}

.line{margin:4px 0;}
.etxekoa{color:#0d47a1;font-weight:bold;}
.kanpokoak{color:#b71c1c;font-weight:bold;}
.score{font-size:1.15em;font-weight:bold;}
.meta{font-size:.9em;color:#333;}
.icon{margin-right:6px;}
.sets{font-size:.95em;font-style:italic;}
.modalitatea a{color:#004d40;text-decoration:none;font-weight:bold;}
.modalitatea a:hover{text-decoration:underline;}
</style>
</head>

<body>

<header>
  <img src="/images/logo-larraun.png">
  <h1>EMAITZAK</h1>
  <img src="/images/logo-fnp.png">
</header>

<main id="content"></main>

<script>
const SOURCES=[
  {url:"/data/resultados-larraun.json",ofiziala:true},
  {url:"/data/resultados-no-oficiales.json",ofiziala:false}
];

function parseDateSafe(fecha){
  if(!fecha) return null;
  const d=new Date(fecha.trim());
  return isNaN(d)?null:d;
}

function monday(d){
  const x=new Date(d);
  const day=x.getDay()||7;
  x.setDate(x.getDate()-day+1);
  x.setHours(0,0,0,0);
  return x;
}

function isHome(fronton){
  return /lekunberri|aldatz/i.test(fronton||"");
}

function formatSets(arr){
  if(!arr || !arr.length) return "";
  return arr.map(s=>{
    const p=s.match(/\d+-\d+/g);
    return p ? p.join("  ") : s;
  }).join(" | ");
}

Promise.all(
  SOURCES.map(s =>
    fetch(s.url).then(r=>r.json())
      .then(arr => arr.map(o=>({
        ...o,
        ofiziala:s.ofiziala,
        _date: parseDateSafe(o.fecha)
      })))
).then(all=>{
  const data=all.flat().sort((a,b)=>{
    if(!a._date) return 1;
    if(!b._date) return -1;
    return a._date-b._date;
  });

  const groups={};
  const fallback=[];

  data.forEach(m=>{
    if(!m._date){ fallback.push(m); return; }
    const key=monday(m._date).toISOString();
    (groups[key] ||= []).push(m);
  });

  const c=document.getElementById("content");

  Object.keys(groups).sort((a,b)=>new Date(b)-new Date(a)).forEach(k=>{
    const s=new Date(k), e=new Date(s); e.setDate(s.getDate()+6);
    c.innerHTML+=`<div class="week-title">ASTEKO EMAITZAK (${s.toLocaleDateString("eu-ES")} ‚Üí ${e.toLocaleDateString("eu-ES")})</div>`;
    render(groups[k]);
  });

  if(fallback.length){
    c.innerHTML+=`<div class="week-title">BESTELAKO EMAITZAK</div>`;
    render(fallback);
  }

  function render(arr){
    arr.forEach(m=>{
      let cls="match ";
      if(!m.ofiziala) cls+="no-oficial ";
      if(m.emaitza){
        const h=isHome(m.fronton);
        cls+= m.emaitza==="irabazita" ? (h?"win-home":"win-away") : (h?"lose-home":"lose-away");
      }

      c.innerHTML+=`
      <div class="${cls}">
        <div class="line meta"><span class="icon">üìÖ</span>${m.fecha||""}</div>
        <div class="line meta"><span class="icon">üìç</span>${m.fronton||""}</div>
        <div class="line etxekoa"><span class="icon">üè†</span>${m.etxekoa||""}</div>
        <div class="line kanpokoak"><span class="icon">‚úàÔ∏è</span>${m.kanpokoak||""}</div>
        <div class="line score">${m.tanteoa||""}</div>
        ${m.sets?.length?`<div class="line sets">${formatSets(m.sets)}</div>`:""}
        <div class="line meta modalitatea">
          <span class="icon">üèÜ</span>
          ${m.url?`<a href="${m.url}" target="_blank">${m.modalidad||""}</a>`:(m.modalidad||"")}
        </div>
      </div>`;
    });
  }
});
</script>

</body>
</html>
