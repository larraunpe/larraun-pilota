<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<title>Larraun ‚Äì Emaitzak</title>
<link rel="icon" type="image/png" href="/emaitzak.png">
<meta property="og:title" content="Emaitzak ‚Äì Larraun Pilota Elkartea">
<meta property="og:description" content="Pilotarien azken emaitzak">
<meta property="og:image" content="https://larraunpilota.eus/emaitzak.png">
<meta property="og:url" content="https://larraunpilota.eus/emaitzak.html">

<style>
body{
  font-family:Arial,Helvetica,sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:0;
}

/* ===== HEADER ===== */
header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 20px;
  background:#ffffff;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}
header img{height:48px;}
header h1{
  margin:0;
  font-size:2em;
  color:#004d40;
  letter-spacing:2px;
}

/* ===== CONTENIDO ===== */
main{padding:20px;}

.week-title{
  margin:30px 0 10px;
  font-size:1.4em;
  font-weight:bold;
  color:#004d40;
}

/* ===== TARJETA ===== */
.match{
  background:#fff;
  margin-bottom:14px;
  padding:14px 18px 14px 26px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
  position:relative;
  overflow:hidden;
  display: flex;
  flex-direction: column;
}

/* LATERAL */
.match::after{
  content:"";
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:6px;
  background:#000;
}
.match.win::after{background:#1b8f3a;}
.match.lose::after{background:#b00000;}
.match.pending::after{background:#000;}

/* NO OFICIALES */
.match.no-oficial{background:#f1f1f1;}

/* ===== FRANJAS INCLINADAS ===== */
.match::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.match.win::before {
  opacity: 0.4;
  background: repeating-linear-gradient(
    45deg,
    transparent,
    transparent 10px,
    rgba(255, 215, 0, 0.5) 10px,
    rgba(255, 215, 0, 0.5) 20px
  );
}

.match.lose::before {
  opacity: 0.4;
  background: repeating-linear-gradient(
    45deg,
    transparent,
    transparent 10px,
    rgba(192, 192, 192, 0.5) 10px,
    rgba(192, 192, 192, 0.5) 20px
  );
}

/* ===== ETIQUETA DE FASE ===== */
.fase-etiqueta {
  position: absolute;
  top: 10px;
  right: 12px;
  font-size: .7em;
  font-weight: bold;
  padding: 4px 8px;
  border-radius: 20px;
  background: #6c757d;
  color: #fff;
  z-index: 2;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.fase-etiqueta.fase-especial {
  background: #ffc107;
  color: #212529;
  box-shadow: 0 0 12px rgba(255, 215, 0, 0.7);
  border: 1px solid #ffa500;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% { box-shadow: 0 0 12px rgba(255, 215, 0, 0.7); }
  50% { box-shadow: 0 0 18px rgba(255, 215, 0, 0.9); }
  100% { box-shadow: 0 0 12px rgba(255, 215, 0, 0.7); }
}

/* ===== BADGES ===== */
.badge{
  position:absolute;
  top:10px;
  right:12px;
  font-size:.7em;
  font-weight:bold;
  padding:4px 8px;
  border-radius:6px;
  background:#b00000;
  color:#fff;
  z-index: 2;
}
.badge.beste-ofiziala{
  background:#198754;
}

/* Ajuste para que los badges no se solapen con la etiqueta de fase */
.match .badge {
  right: auto;
  left: 12px;
}

/* ===== TEXTO ===== */
.line{margin:6px 0; position: relative; z-index: 2;}
.meta{font-size:.9em;color:#333;}

.etxekoa-line{
  color:#0d47a1;
  font-weight:bold;
  font-size:1.05em;
  text-transform:uppercase;
  position: relative;
  z-index: 2;
}
.kanpokoa-line{
  color:#b71c1c;
  font-weight:bold;
  font-size:1.05em;
  text-transform:uppercase;
  position: relative;
  z-index: 2;
}

/* FRONT√ìN DESTACADO */
.fronton-destacado{
  background:#e3f2fd;
  padding:2px 6px;
  border-radius:4px;
  font-style:italic;
  font-weight:bold;
}

/* ===== MARCADOR ===== */
.scoreboard{
  display:flex;
  justify-content:center;
  margin:10px 0;
  font-size:1.6em;
  font-weight:bold;
  position: relative;
  z-index: 2;
}
.scorebox{
  min-width:56px;
  padding:6px 0;
  text-align:center;
  color:#fff;
}
.scorebox.blue{background:#0d47a1;}
.scorebox.red{background:#b71c1c;}

.sets{
  text-align:center;
  font-size:.95em;
  color:#333;
  position: relative;
  z-index: 2;
}

.modalidad{
  font-size:.9em;
  color:#004d40;
  font-weight:600;
  position: relative;
  z-index: 2;
}
.modalidad a{
  color:#004d40;
  text-decoration:none;
}
.modalidad a:hover{text-decoration:underline;}

.rest-separator{
  margin:20px 0 10px;
  text-align:center;
  font-weight:bold;
  color:#666;
  letter-spacing:1px;
}

/* Mapeo de fases (lo usaremos en JS) */
.fase-mapping {
  display: none;
}
</style>
</head>

<body>

<header>
  <img src="/images/logo-larraun.png" alt="Larraun">
  <h1>EMAITZAK</h1>
  <img src="/images/logo-fnp.png" alt="FNP">
</header>

<main id="content"></main>

<script>
// Mapeo de fases (desde tu JSON)
const FASE_MAPPING = {
  "LIGAXKA": "LIGAXKA",
  "KANPORAKETA": "KANPORAKETA",
  "FINAL ZORTZIRENAK": "FINAL ZORTZIRENAK",
  "FINAL LAURDENEN LIGAXKA": "FINAL LAURDENEN LIGAXKA",
  "FINAL LAURDENAK": "FINAL LAURDENAK",
  "FINAL AURREKOAK": "FINAL AURREKOAK",
  "FINALA": "FINALA",
  "LIGA": "LIGA",
  "FINAL ERDIAK": "FINAL ERDIAK",
  "SEMIFINALA": "SEMIFINALA"
};

const SOURCES=[
  {url:"/data/resultados-larraun.json", origen:"oficial"},
  {url:"/data/resultados-no-oficiales.json", origen:"no-oficial"}
];

function parseDate(f){return f?new Date(f+"T00:00"):null;}
function monday(d){
  const x=new Date(d);
  const day=x.getDay()||7;
  if(day!==1) x.setDate(x.getDate()-day+1);
  x.setHours(0,0,0,0);
  return x;
}
function frontonDestacado(f){return /lekunberri|aldatz/i.test(f||"");}
function esDescanso(m){
  return /atsedena/i.test(m.etxekoa) || /atsedena/i.test(m.kanpokoak);
}
function formatSets(sets){
  return sets.join(" ").replace(/\(/g," / ").replace(/\)/g,"");
}

function ordenarSemana(arr){
  const normales = arr.filter(m => !esDescanso(m));
  const descansos = arr.filter(m => esDescanso(m));

  normales.sort((a,b)=>{
    if (a._date - b._date !== 0) return a._date - b._date;
    return (a.fronton||"").localeCompare(b.fronton||"");
  });

  return [...normales, ...descansos];
}

Promise.all(
  SOURCES.map(s =>
    fetch(s.url)
      .then(r=>r.json())
      .then(arr =>
        arr.map(o => ({
          ...o,
          origen: s.origen,
          ofiziala:
            s.origen==="no-oficial"
              ? String(o.ofiziala).toLowerCase()==="true"
              : true,
          _date: parseDate(o.fecha),
          // Normalizamos la fase usando el mapping
          fase_normalizada: FASE_MAPPING[o.modalidad] || o.modalidad || ""
        }))
      )
  )
).then(all=>{
  const today=new Date(); today.setHours(0,0,0,0);
  const data=all.flat().filter(m=>m._date&&m._date<=today);

  const thisMon=monday(today);
  const lastMon=new Date(thisMon); lastMon.setDate(thisMon.getDate()-7);
  const lastSun=new Date(thisMon); lastSun.setDate(thisMon.getDate()-1);

  const thisWeek=[], lastWeek=[];
  data.forEach(m=>{
    if(m._date>=thisMon) thisWeek.push(m);
    else if(m._date>=lastMon&&m._date<=lastSun) lastWeek.push(m);
  });

  const c=document.getElementById("content");

  function render(title,arr){
    if(!arr.length) return;
    arr = ordenarSemana(arr);

    c.innerHTML+=`<div class="week-title">${title}</div>`;
    let descansoMostrado=false;

    arr.forEach(m=>{
      if(esDescanso(m)&&!descansoMostrado){
        c.innerHTML+=`<div class="rest-separator">‚Äî JARDUNALDIKO ATSEDENAK ‚Äî</div>`;
        descansoMostrado=true;
      }

      const esBesteOfizial = m.origen==="no-oficial" && m.ofiziala===true;
      const esNoOficial   = m.origen==="no-oficial" && m.ofiziala===false;

      let cls = "match ";
      if (esNoOficial) cls += "no-oficial ";

      const emaitza = (m.emaitza || "").toLowerCase().trim();

      if (!emaitza) {
        cls += "pending";
      } else if (emaitza === "irabazita") {
        cls += "win";
      } else {
        cls += "lose";
      }

      let marcador="";
      if(m.tanteoa&&m.tanteoa.includes("-")){
        const[a,b]=m.tanteoa.split("-").map(x=>x.trim());
        marcador=`
        <div class="scoreboard">
          <div class="scorebox blue">${a}</div>
          <div class="scorebox red">${b}</div>
        </div>`;
      }

      const modalidadHTML=
        m.url&&m.url!=="-"
        ? `<span class="modalidad"><a href="${m.url}" target="_blank">üèÜ ${m.modalidad}</a> üîó</span>`
        : `<span class="modalidad">üèÜ ${m.modalidad||""}</span>`;

      // Determinar la clase especial para la fase (si es FINALA)
      const faseEspecial = m.fase_normalizada === "FINALA" ? "fase-especial" : "";
      
      // Crear la etiqueta de fase (solo si hay fase)
      const faseEtiqueta = m.fase_normalizada ? 
        `<div class="fase-etiqueta ${faseEspecial}">${m.fase_normalizada}</div>` : "";

      c.innerHTML+=`
      <div class="${cls}">
        ${esNoOficial ? `<div class="badge">EZ OFIZIALA</div>` : ""}
        ${esBesteOfizial ? `<div class="badge beste-ofiziala">OFIZIALA</div>` : ""}
        ${faseEtiqueta}

        <div class="line meta">üìÖ ${m.fecha}</div>
        <div class="line etxekoa-line">üè† ${m.etxekoa||""}</div>
        <div class="line kanpokoa-line">‚úàÔ∏è ${m.kanpokoak||""}</div>

        ${marcador}
        ${m.sets?.length?`<div class="sets">üéØ ${formatSets(m.sets)}</div>`:""}

        <div class="line meta ${frontonDestacado(m.fronton)?'fronton-destacado':''}">
          üìç ${m.fronton||""}
        </div>

        <div class="line meta">${modalidadHTML}</div>
      </div>`;
    });
  }

  render("ASTE HONETAKO EMAITZAK", thisWeek);
  render("AURREKO ASTEKO EMAITZAK", lastWeek);
});
</script>

</body>
</html>
