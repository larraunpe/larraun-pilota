<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8"/>
<title>Kartela</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>

/* ===== BASE ===== */

body{
  margin:0;
  background:#1b4d31;
  font-family:"Trebuchet MS","Arial Black",sans-serif;
}

.pagina{
  width:900px;
  height:1400px;
  margin:20px auto;
  position:relative;
  overflow:hidden;
  background:#3f8159;
}

/* ===== PELOTAZOS ===== */

.pelotazos{
  position:absolute;
  inset:0;
  z-index:1;
}

.pelota{
  position:absolute;
  width:3px;
  height:3px;
  background:black;
  border-radius:50%;
  opacity:.15;
}

/* ===== HEADER ===== */

.header{
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:150px;
  background:#2448b5;
  z-index:3;
  box-shadow: inset 0 -12px 18px rgba(0,0,0,.6);
}

/* ===== CONTENIDO ===== */

.contenido-wrapper{
  position:absolute;
  top:150px;
  bottom:240px;
  left:0;
  right:0;
  overflow:hidden;
  z-index:2;
}

.contenido{
  padding:14px 20px;
  transform-origin:top left;
}

/* ===== BLOQUES ===== */

.bloque h2{
  color:white;
  text-align:center;
  margin:10px 0;
}

.grupo{
  background:white;
  border-radius:10px;
  overflow:hidden;
  margin-top:6px;
}

.grupo-header{
  background:#2448b5;
  color:white;
  padding:8px 12px;
  font-weight:bold;
}

.rojo{background:#b00000;}

.linea{
  display:flex;
  gap:8px;
  padding:6px;
  border-top:1px solid #ddd;
  font-weight:900;
  font-size:.9em;
}

.zkia{width:24px}
.etxekoa{color:#2448b5}
.kanpokoa{color:#b00000}
.lehiaketa{margin-left:auto}

/* ===== FOOTER ===== */

.footer{
  position:absolute;
  bottom:0;
  left:0;
  right:0;
  height:240px;
  z-index:3;
}

.pie-gris{
  background:#2f2f2f;
  height:80px;
  padding:8px;
}

.suelo{
  background:#6b6b6b;
  height:160px;
}

.logos-grid{
  display:grid;
  grid-template-columns:repeat(10,1fr);
  gap:6px;
}

.logo-item{
  background:white;
  border-radius:6px;
  padding:4px;
}

.logo-item img{
  width:100%;
  height:32px;
  object-fit:contain;
}

.exportar{
  text-align:center;
  margin:15px;
}

</style>
</head>

<body>

<div class="exportar">
<button onclick="exportar()">ðŸ“¸ JPG</button>
</div>

<div class="pagina" id="pagina">

<div class="pelotazos" id="pelotazos"></div>

<div class="header">
<svg viewBox="0 0 600 180" width="100%">
<defs>
<path id="arco" d="M30,130 Q300,20 570,130"/>
</defs>
<text text-anchor="middle" font-size="40" font-weight="900" fill="white">
<textPath href="#arco" startOffset="50%">
LARRAUN PILOTA ELKARTEA
</textPath>
</text>
</svg>
</div>

<div class="contenido-wrapper">
  <div class="contenido" id="contenido"></div>
</div>

<div class="footer">
  <div class="pie-gris">
    <div class="logos-grid" id="logos"></div>
  </div>
  <div class="suelo"></div>
</div>

</div>

<script>

/* ===== pelotazos ===== */

for(let i=0;i<1800;i++){
 const d=document.createElement("div");
 d.className="pelota";
 d.style.left=Math.random()*900+"px";
 d.style.top=Math.random()*1200+"px";
 pelotazos.appendChild(d);
}

/* ===== logos ===== */

["aliprox.jpg","arbeondo.jpg","barainhoa.jpg","kotxera.jpg"]
.forEach(f=>{
 logos.innerHTML+=`<div class="logo-item"><img src="images/patrocinio/${f}"></div>`;
});

/* ===== util ===== */

const esDescanso=t=>/descanso|atseden/i.test(t||"");
const normalizaHora=h=>h?h.slice(0,5):"00:00";

/* ===== cargar ===== */

Promise.all([
 fetch("data/cartelera-larraun.json").then(r=>r.json()),
 fetch("data/partidos-no-oficiales.json").then(r=>r.json())
]).then(([oficiales,otros])=>{

pinta("ORDUTEGIAK",oficiales);
pinta("BESTE TXAPELKETAK",otros);

autoEscalar();

});

/* ===== pintar ===== */

function pinta(titulo,data){

 if(!data.length) return;

 contenido.innerHTML+=`<div class="bloque"><h2>${titulo}</h2></div>`;
 const bloque=contenido.lastChild;

 data.forEach(p=>{

  if(esDescanso(p.etxekoa)||esDescanso(p.kanpokoak)) return;

  const rojo=!/lekunberri|aldatz/i.test(p.fronton||"");

  bloque.innerHTML+=`
  <div class="grupo">
   <div class="grupo-header ${rojo?'rojo':''}">
   ${p.fecha} ${normalizaHora(p.hora)} Â· ${p.fronton}
   </div>
   <div class="linea">
     <div class="zkia">${p.zkia}</div>
     <div class="etxekoa">${p.etxekoa}</div>
     <div class="kanpokoa">${p.kanpokoak}</div>
     <div class="lehiaketa">${p.lehiaketa}</div>
   </div>
  </div>`;
 });

}

/* ===== AUTO ESCALA (clave) ===== */

function autoEscalar(){
 const wrap=document.querySelector(".contenido-wrapper");
 const cont=document.querySelector(".contenido");

 const ratio=wrap.clientHeight/cont.scrollHeight;

 if(ratio<1){
  cont.style.transform=`scale(${ratio})`;
 }
}

/* ===== exportar ===== */

function exportar(){
 html2canvas(pagina,{scale:2}).then(c=>{
  const a=document.createElement("a");
  a.href=c.toDataURL("image/jpeg",0.95);
  a.download="kartela.jpg";
  a.click();
 });
}

</script>

</body>
</html>
