<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8" />
<title>Larraun Kartela</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>

/* ================= BASE ================= */

body{
  margin:0;
  background:#1b4d31;
  font-family:"Trebuchet MS","Arial Black",sans-serif;
}

/* ================= P√ÅGINA ================= */

.pagina{
  width:900px;
  height:1400px;
  margin:25px auto;

  display:flex;
  flex-direction:column;

  background:#3f8159;
  position:relative;
  overflow:hidden;
}

/* ================= HEADER ================= */

.header{
  flex:0 0 130px;
  background:#2448b5;
  color:white;

  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;

  box-shadow:
    inset 0 8px 10px rgba(255,255,255,.3),
    inset 0 -12px 16px rgba(0,0,0,.6);
}

.header img{height:60px}

.chapa{height:12px;background:#000}

/* ================= CONTENIDO ================= */

.contenido{
  flex:1;                 /* ‚Üê ocupa todo el espacio libre */
  overflow:auto;          /* ‚Üê nunca invade el footer */
  padding:18px 22px;
}

/* ================= BLOQUES ================= */

.bloque h2{
  color:white;
  text-align:center;
}

/* ================= PARTIDOS ================= */

.grupo{
  background:white;
  border-radius:10px;
  margin-top:8px;
  overflow:hidden;
}

.grupo-header{
  padding:8px 12px;
  font-weight:bold;
  background:#2448b5;
  color:white;
}

.grupo-header.rojo{background:#b00000}

.linea{
  display:flex;
  gap:8px;
  padding:8px;
  border-top:1px solid #ddd;
  font-weight:900;
}

.zkia{width:28px}
.etxekoa{color:#2448b5}
.kanpokoa{color:#b00000}

.lehiaketa{
  margin-left:auto;
  text-align:right;
}

/* ================= FOOTER FIJO ================= */

.footer{
  flex:0 0 240px;  /* altura fija */
  display:flex;
  flex-direction:column;
}

.pie-gris{
  background:#2f2f2f;
  padding:10px;
  height:80px;      /* colch√≥n */
}

.suelo{
  background:#6b6b6b;
  flex:1;           /* suelo el doble */
}

/* logos */

.logos-grid{
  display:grid;
  grid-template-columns:repeat(10,1fr);
  gap:8px;
}

.logo-item{
  background:white;
  border-radius:6px;
  padding:6px;
}

.logo-item img{
  width:100%;
  height:34px;
  object-fit:contain;
}

.exportar{
  text-align:center;
  margin:15px;
}

</style>
</head>

<body>

<div class="exportar">
<button onclick="exportar()">üì∏ DESKARGATU JPG</button>
</div>

<div class="pagina" id="pagina">

  <div class="chapa"></div>

  <div class="header">
    <img src="images/logo-larraun.png">
    <h1>LARRAUN PILOTA ELKARTEA</h1>
    <img src="images/logo-fnp.png">
  </div>

  <div class="chapa"></div>

  <div class="contenido" id="contenido"></div>

  <div class="chapa"></div>

  <div class="footer">
    <div class="pie-gris">
      <div class="logos-grid" id="logos"></div>
    </div>
    <div class="suelo"></div>
  </div>

</div>

<script>

/* ================= UTIL ================= */

function esDescanso(txt){
  if(!txt) return false;
  return /descanso|atseden/i.test(txt);
}

function normalizaHora(h){
  return h ? h.slice(0,5) : "00:00";
}

function ordenar(data){
  return data.sort((a,b)=>{
    if(a.fecha!==b.fecha) return a.fecha.localeCompare(b.fecha);
    return normalizaHora(a.hora).localeCompare(normalizaHora(b.hora));
  });
}

function agrupar(data){
  const g={};
  data.forEach(p=>{
    const k=`${p.fecha}|${normalizaHora(p.hora)}|${p.fronton}`;
    (g[k]=g[k]||[]).push(p);
  });
  return g;
}

/* ================= LOGOS ================= */

const LOGOS=["aliprox.jpg","arbeondo.jpg","barainhoa.jpg","kotxera.jpg"];

const logos=document.getElementById("logos");

LOGOS.forEach(f=>{
  logos.innerHTML+=`<div class="logo-item"><img src="images/patrocinio/${f}"></div>`;
});

/* ================= CARGAR PARTIDOS ================= */

Promise.all([
  fetch("data/cartelera-larraun.json").then(r=>r.json()),
  fetch("data/partidos-no-oficiales.json").then(r=>r.json())
]).then(([oficiales,noOficiales])=>{

const todos=[...oficiales,...noOficiales];

const cont=document.getElementById("contenido");

Object.values(agrupar(ordenar(todos))).forEach(partidos=>{

  /* quitar descansos */
  partidos = partidos.filter(p =>
    !esDescanso(p.etxekoa) && !esDescanso(p.kanpokoak)
  );

  if(!partidos.length) return;

  const p0=partidos[0];

  const grupo=document.createElement("div");
  grupo.className="grupo";

  grupo.innerHTML=`
    <div class="grupo-header">
      üìÖ ${p0.fecha} | ‚è∞ ${normalizaHora(p0.hora)} | üìç ${p0.fronton}
    </div>
    ${partidos.map(p=>`
      <div class="linea">
        <div class="zkia">${p.zkia}</div>
        <div class="etxekoa">${p.etxekoa}</div>
        <div class="kanpokoa">${p.kanpokoak}</div>
        <div class="lehiaketa">${p.lehiaketa}</div>
      </div>
    `).join("")}
  `;

  cont.appendChild(grupo);
});

});

/* ================= EXPORTAR ================= */

function exportar(){
  html2canvas(document.getElementById("pagina"),{scale:2})
  .then(c=>{
    const a=document.createElement("a");
    a.download="kartela.jpg";
    a.href=c.toDataURL("image/jpeg",0.95);
    a.click();
  });
}

</script>

</body>
</html>
