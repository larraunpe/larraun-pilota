<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8"/>
<title>Larraun Kartela</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>

/* ================= BASE ================= */

body{
  margin:0;
  background:#1b4d31;
  font-family:"Trebuchet MS","Arial Black",sans-serif;
}

.exportar{
  text-align:center;
  margin:18px;
}

/* ================= P√ÅGINA ================= */

.pagina{
  width:900px;
  margin:30px auto;
  display:flex;
  flex-direction:column;
  background:#3f8159;
  position:relative;
  overflow:hidden;
}

/* ================= PELOTAZOS (por delante) ================= */

.pelotazos{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:50;
  mix-blend-mode:multiply; /* efecto tinta real */
}

.pelota-dot{
  position:absolute;
  border-radius:50%;
  background:#000;
  opacity:.28;
}

/* ================= HEADER ================= */

.header{
  position:relative;
  height:120px;
  background:#2448b5;
  display:flex;
  align-items:center;
  justify-content:center;

  box-shadow:
    inset 0 8px 10px rgba(255,255,255,.3),
    inset 0 -12px 16px rgba(0,0,0,.6);
}

/* logos laterales M√ÅS GRANDES */
.logo-izq,.logo-der{
  position:absolute;
  top:18px;
  height:85px;
}
.logo-izq{ left:14px; }
.logo-der{ right:14px; }

/* t√≠tulo M√ÅS curvado */
.titulo-curvo{
  width:100%;
  height:100px;
}

.titulo-curvo text{
  font-size:34px;
  font-weight:900;
  fill:white;
  letter-spacing:2px;
}

/* pelota M√ÅS peque√±a y M√ÅS arriba */
.pelota-real{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  bottom:40px;

  width:34px;
  height:34px;

  border-radius:50%;
  background:#fff;
  border:2px solid #ddd;

  z-index:20;

  box-shadow: inset 0 2px 4px rgba(0,0,0,.25);
}

/* costuras rojas */
.pelota-real::before,
.pelota-real::after{
  content:"";
  position:absolute;
  width:80%;
  height:40%;
  left:10%;
  border-top:2px solid #c40000;
  border-radius:50%;
}

.pelota-real::before{ top:6px; }
.pelota-real::after{ bottom:6px; }

/* ================= CHAPAS ================= */

.chapa{
  height:12px;
  background:#000;
}

/* ================= CONTENIDO ================= */

.contenido{
  padding:20px;
  position:relative;
  z-index:2;
}

/* ================= BLOQUES ================= */

.bloque h2{
  text-align:center;
  margin:30px 0 20px 0;

  font-size:28px;
  font-weight:900;
  letter-spacing:3px;
  text-transform:uppercase;

  /* color piedra clara */
  color:#f8f8f8;

  /* EFECTO ESCULPIDO EN FRONT√ìN */
  text-shadow:
    0 2px 0 #ffffff,                /* luz arriba */
    0 4px 0 #e6e6e6,
    0 -2px 0 rgba(0,0,0,.45),       /* sombra tallado */
    2px 3px 4px rgba(0,0,0,.55),    /* profundidad */
    -1px -1px 0 rgba(255,255,255,.6);

  /* textura piedra / grietas */
  background:
    repeating-linear-gradient(
      45deg,
      rgba(0,0,0,.06) 0px,
      rgba(0,0,0,.06) 2px,
      transparent 2px,
      transparent 6px
    );

  -webkit-background-clip:text;
  background-clip:text;

  filter:contrast(110%) brightness(115%);
}



/* ================= PARTIDOS ================= */

.grupo{
  background:#fff;
  border-radius:10px;
  overflow:hidden;
  margin-bottom:8px;
}

.grupo-header{
  padding:6px 12px;
  font-weight:bold;
  color:#fff;
  background:#2448b5;
  font-size:13px;
}

.grupo-header.rojo{
  background:#b00000;
}

.linea{
  display:flex;
  gap:8px;
  padding:6px 10px;
  border-top:1px solid #ddd;
  font-weight:900;
  font-size:13px;
}

.zkia{width:30px}
.etxekoa{color:#2448b5}
.kanpokoa{color:#b00000}
.lehiaketa{margin-left:auto}

/* ================= FOOTER ================= */

.footer{
  display:flex;
  flex-direction:column;
}

.pie-gris{
  background:#2f2f2f;
  padding:10px;
}



/* patrocinadores */

.logos-grid{
  display:grid;
  grid-template-columns:repeat(10,1fr);
  gap:8px;
}

.logo-item{
  background:#fff;
  padding:6px;
  border-radius:6px;
}

.logo-item img{
  width:100%;
  height:36px;
  object-fit:contain;
}

</style>
</head>

<body>

<div class="exportar">
<button onclick="exportar()">üì∏ DESKARGATU JPG</button>
</div>

<div id="pagina" class="pagina">

<div class="pelotazos" id="pelotazos"></div>

<!-- HEADER -->
<div class="header">

<img src="images/logo-larraun.png" class="logo-izq">
<img src="images/logo-fnp.png" class="logo-der">

<svg class="titulo-curvo" viewBox="0 0 900 120">
  <!-- M√ÅS curvatura -->
  <path id="arco" d="M60,110 Q450,-60 840,110" fill="transparent"/>
  <text text-anchor="middle">
    <textPath href="#arco" startOffset="50%">
      LARRAUN PILOTA ELKARTEA
    </textPath>
  </text>
</svg>

<!-- pelota -->
<div class="pelota-real"></div>
</div>

<div class="chapa"></div>

<div id="contenido" class="contenido"></div>

<div class="chapa"></div>

<div class="footer">
  <div class="pie-gris">
    <div id="logos" class="logos-grid"></div>
  </div>
 
</div>

</div>

<script>

/* ================= PELOTAZOS ================= */

const pel=document.getElementById("pelotazos");

for(let i=0;i<4500;i++){
  const d=document.createElement("div");
  const s=Math.random()*4+2;
  d.className="pelota-dot";
  d.style.width=d.style.height=s+"px";
  d.style.left=Math.random()*900+"px";
  d.style.top=Math.random()*2400+"px";
  pel.appendChild(d);
}



/* ================= LOGOS PATROCINADORES ================= */

const LOGOS=["aliprox.jpg","arbeondo.jpg","asadorepeleta.jpg","barainhoa.jpg","kotxera.jpg",
"barilargi.jpg","barlekuonberri.jpg","bego√±ajanaridenda.jpg","carniceriaartxueta.jpg",
"carpinteriahnosazpiroz.jpg","construccionesga√±arbe.jpg","construccionesgarciarenasaralegi.jpg",
"construccionesurangasaigos.jpg","fisioterapiaandoniayerdi.jpg","hotelayestaran.jpg",
"iseelectricidad.jpg","kattagorrielkartea.jpg","lacturale.jpg","lagunasesoria.jpg",
"maderasnasorena.jpg","maskarada.jpg","sojonatura.jpg","suacontrol.jpg","urzubi.jpg",
"ventamugiro.jpg","construccioneslansalot.jpg","dietistaanagurrea.jpg","ekin.jpg",
"farmaciaitziarmendia.png","fontaneriabalenciaga.jpg","fontaneriairibarren.jpg",
"izarberri.png","lakita.jpg","nekazari.jpg","sidreriatokialai.jpg","tallereslarraun.jpg",
"talleresotxotorena.jpg","veterinarialekunberri.jpg"];

document.getElementById("logos").innerHTML =
LOGOS.map(f=>`<div class="logo-item"><img src="images/patrocinio/${f}"></div>`).join("");

/* ================= DESCANSO ================= */

const esDescanso = t => !t || /descanso|atseden/i.test(t);

function normalizaHora(h){
  return h ? h.slice(0,5) : "00:00";
}

/* ================= CONFIG A3 ================= */

const PAGE_WIDTH = 1200;
const PAGE_HEIGHT = 1700;

const HEADER_HTML = document.querySelector(".header").outerHTML +
                    document.querySelectorAll(".chapa")[0].outerHTML;

const FOOTER_HTML = document.querySelectorAll(".chapa")[1].outerHTML +
                    document.querySelector(".footer").outerHTML;


/* ================= CREAR P√ÅGINA ================= */

function nuevaPagina(){
  const p = document.createElement("div");
  p.className = "pagina-a3";
  p.style.width = PAGE_WIDTH+"px";
  p.style.height = PAGE_HEIGHT+"px";
  p.style.background = "#3f8159";
  p.style.display = "flex";
  p.style.flexDirection = "column";
  p.style.position = "relative";
  p.style.margin = "40px auto";

  p.innerHTML = HEADER_HTML +
                `<div class="contenido-pagina" style="flex:1;padding:20px;overflow:hidden"></div>` +
                FOOTER_HTML;

  document.body.appendChild(p);

  return p.querySelector(".contenido-pagina");
}


/* ================= PAGINADOR ================= */

function paginarBloques(bloques){

  let cont = nuevaPagina();

  bloques.forEach(b=>{

    const clon = b.cloneNode(true);

    cont.appendChild(clon);

    if(cont.scrollHeight > cont.clientHeight){

      cont.removeChild(clon);

      cont = nuevaPagina();

      cont.appendChild(clon);
    }

  });
}


/* ================= EXPORTAR TODAS ================= */

async function exportar(){

  const paginas = document.querySelectorAll(".pagina-a3");

  let i = 1;

  for(const p of paginas){

    const canvas = await html2canvas(p,{
      scale:2,
      useCORS:true
    });

    const a=document.createElement("a");
    a.href=canvas.toDataURL("image/jpeg",0.95);
    a.download=`kartela-${i}.jpg`;
    a.click();

    i++;
  }
}


/* ================= FETCH PARTIDOS ================= */

Promise.all([
 fetch("data/cartelera-larraun.json").then(r=>r.json()),
 fetch("data/partidos-no-oficiales.json").then(r=>r.json())
]).then(([oficiales,noOficiales])=>{

const bloques = [];

function crearBloque(titulo,data){

 const bloque=document.createElement("div");
 bloque.className="bloque";
 bloque.innerHTML=`<h2>${titulo}</h2>`;

 const grupos={};

 data.forEach(p=>{
   if(!p.etxekoa || !p.kanpokoak) return;
   const key=p.fecha+"|"+p.hora+"|"+p.fronton;
   if(!grupos[key]) grupos[key]=[];
   grupos[key].push(p);
 });

 Object.values(grupos).forEach(partidos=>{

   const p0=partidos[0];
   const local=/lekunberri|aldatz/i.test(p0.fronton||"");

   const g=document.createElement("div");
   g.className="grupo";

   g.innerHTML=`
   <div class="grupo-header ${!local?'rojo':''}">
   üìÖ ${p0.fecha} | ‚è∞ ${p0.hora} | üìç ${p0.fronton}
   </div>
   ${partidos.map(p=>`
     <div class="linea">
       <div class="zkia">${p.zkia}</div>
       <div class="etxekoa">${p.etxekoa}</div>
       <div class="kanpokoa">${p.kanpokoak}</div>
       <div class="lehiaketa">${p.lehiaketa}</div>
     </div>
   `).join("")}`;

   bloque.appendChild(g);

 });

 bloques.push(bloque);
}


/* crear bloques */
crearBloque("ORDUTEGIAK", oficiales);
crearBloque("BESTE TXAPELKETAK OFIZIALAK", noOficiales.filter(p=>String(p.ofiziala)==="true"));
crearBloque("TXAPELKETAK EZ OFIZIALAK", noOficiales.filter(p=>String(p.ofiziala)!=="true"));


/* paginar */
paginarBloques(bloques);

});

</script>

</body>
</html>
