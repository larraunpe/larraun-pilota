<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8" />
<title>Larraun Kartela</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>

/* ================= BASE ================= */

body{
  margin:0;
  background:#1b4d31;
  font-family:"Trebuchet MS","Arial Black",sans-serif;
}

.exportar{
  text-align:center;
  margin:18px;
}

/* ================= PAGINA √öNICA ================= */

.pagina{
  width:900px;
  height:1400px;
  margin:25px auto;

  display:flex;
  flex-direction:column;

  position:relative;
  overflow:hidden;

  background:#3f8159;
}

/* textura */
.pagina::before{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    repeating-linear-gradient(45deg,rgba(255,255,255,.02) 0 2px,rgba(0,0,0,.03) 2px 4px);
}

/* ================= HEADER ================= */

.header{
  height:130px;
  background:#2448b5;
  color:#fff;

  display:flex;
  align-items:center;
  justify-content:space-between;

  padding:0 20px;

  box-shadow:
    inset 0 10px 12px rgba(255,255,255,.3),
    inset 0 -14px 18px rgba(0,0,0,.7);
}

.header img{ height:60px }

.header h1{
  font-size:34px;
  letter-spacing:2px;
  margin:0;
}

/* ================= CHAPA ================= */

.chapa{
  height:12px;
  background:#000;
}

/* ================= CONTENIDO ================= */

.contenido{
  flex:1;
  padding:16px 20px;
  overflow:hidden; /* üëà nunca pisa el footer */
}

/* ================= BLOQUES ================= */

.bloque{
  margin-bottom:18px;
}

.bloque h2{
  color:#fff;
  text-align:center;
  margin:12px 0;
}

/* ================= PARTIDOS ================= */

.grupo{
  background:#fff;
  border-radius:10px;
  overflow:hidden;
  margin-top:6px;
}

.grupo-header{
  padding:8px 14px;
  font-weight:bold;
  color:#fff;
  background:#2448b5;
}

.grupo-header.rojo{
  background:#b00000;
}

.linea{
  display:flex;
  padding:8px 10px;
  gap:8px;
  font-weight:900;
  border-top:1px solid #ddd;
}

.zkia{width:28px}
.etxekoa{color:#2448b5}
.kanpokoa{color:#b00000}
.lehiaketa{margin-left:auto}

/* ================= FOOTER FIJO ================= */

.footer{
  height:240px;
  display:flex;
  flex-direction:column;
}

.pie-gris{
  background:#2f2f2f;
  padding:8px;
  height:80px; /* 1/3 */
}

.suelo{
  background:#6b6b6b;
  flex:1; /* 2/3 */
}

/* logos */

.logos-grid{
  display:grid;
  grid-template-columns:repeat(10,1fr);
  gap:8px;
}

.logo-item{
  background:#fff;
  padding:6px;
  border-radius:6px;
}

.logo-item img{
  width:100%;
  height:36px;
  object-fit:contain;
}

</style>
</head>

<body>

<div class="exportar">
<button onclick="exportar()">üì∏ DESKARGATU JPG</button>
</div>

<div class="pagina" id="pagina">

<div class="chapa"></div>

<div class="header">
  <img src="images/logo-larraun.png">
  <h1>LARRAUN PILOTA ELKARTEA</h1>
  <img src="images/logo-fnp.png">
</div>

<div class="chapa"></div>

<div class="contenido" id="contenido"></div>

<div class="chapa"></div>

<div class="footer">
  <div class="pie-gris">
    <div class="logos-grid" id="logos"></div>
  </div>
  <div class="suelo"></div>
</div>

</div>

<script>

/* ================= LOGOS ================= */

const LOGOS=[
"aliprox.jpg","arbeondo.jpg","asadorepeleta.jpg","barainhoa.jpg","kotxera.jpg"
];

document.getElementById("logos").innerHTML =
LOGOS.map(f=>`<div class="logo-item"><img src="images/patrocinio/${f}"></div>`).join("");

/* ================= HELPERS ================= */

function normalizaHora(h){
  return h ? h.slice(0,5) : "00:00";
}

function esDescanso(p){
  const t=(p.etxekoa+p.kanpokoak).toLowerCase();
  return t.includes("descanso") || t.includes("atseden");
}

/* ================= CARGA PARTIDOS (SIN PAGINAR) ================= */

Promise.all([
fetch("data/cartelera-larraun.json").then(r=>r.json()),
fetch("data/partidos-no-oficiales.json").then(r=>r.json())
]).then(([oficiales,noOficiales])=>{

const cont=document.getElementById("contenido");

const todos=[...oficiales,...noOficiales]
  .filter(p=>!esDescanso(p)) /* üëà quitamos descansos */
  .sort((a,b)=>a.fecha.localeCompare(b.fecha) || normalizaHora(a.hora).localeCompare(normalizaHora(b.hora));

todos.forEach(p=>{

const div=document.createElement("div");
div.className="grupo";

div.innerHTML=`
<div class="grupo-header">
üìÖ ${p.fecha} | ‚è∞ ${normalizaHora(p.hora)} | üìç ${p.fronton}
</div>
<div class="linea">
<div class="zkia">${p.zkia||""}</div>
<div class="etxekoa">${p.etxekoa||""}</div>
<div class="kanpokoa">${p.kanpokoak||""}</div>
<div class="lehiaketa">${p.lehiaketa||""}</div>
</div>
`;

cont.appendChild(div);

});

});

/* ================= EXPORTAR ================= */

async function exportar(){
const canvas=await html2canvas(document.getElementById("pagina"),{scale:2,useCORS:true});
const a=document.createElement("a");
a.download="kartela.jpg";
a.href=canvas.toDataURL("image/jpeg",0.95);
a.click();
}

</script>

</body>
</html>
