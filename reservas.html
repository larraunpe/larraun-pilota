<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<title>Erreserbak · Reservas</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="users.js"></script>

<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0 }
.hidden { display:none }

.login, .app {
  max-width:1000px;
  margin:auto;
  padding:20px;
}

.top-bar {
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.lang-selector button {
  margin-left:5px;
  padding:6px 10px;
  cursor:pointer;
}

input, button {
  padding:10px;
  margin:6px 0;
  width:100%;
  max-width:300px;
}

button {
  border:none;
  border-radius:6px;
  cursor:pointer;
}

.calendar {
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
  margin-top:20px;
}

.day {
  background:#fff;
  padding:10px;
  border-radius:6px;
  text-align:center;
  cursor:pointer;
}

.hours {
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:6px;
  margin-top:20px;
}

.hour {
  padding:8px;
  border-radius:6px;
  text-align:center;
  cursor:pointer;
}

.hour.selected { background:#ffb3b3!important }

.fronton { background:#bde7ff }
.trinquete { background:#c7f5d9 }

.space-btn {
  padding:10px 16px;
  font-weight:bold;
  border-radius:6px;
  margin-right:10px;
}

.space-btn.fronton { background:#4fc3f7; color:#00324d }
.space-btn.trinquete { background:#66d19e; color:#0b3d2e }

.admin {
  background:#222;
  color:#fff;
  padding:15px;
  margin-top:30px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login" id="login">
  <h2 data-i18n="login_title"></h2>
  <input id="user" data-i18n-placeholder="user">
  <input id="pass" type="password" data-i18n-placeholder="pass">
  <button onclick="login()" data-i18n="enter"></button>
  <p id="msg" style="color:red"></p>
</div>

<!-- APP -->
<div class="app hidden" id="app">

  <div class="top-bar">
    <h2 id="welcome"></h2>
    <div class="lang-selector">
      <button onclick="setLang('eu')">EU</button>
      <button onclick="setLang('es')">ES</button>
    </div>
  </div>

  <button class="space-btn fronton" onclick="setSpace('fronton')" data-i18n="fronton"></button>
  <button class="space-btn trinquete" onclick="setSpace('trinquete')" data-i18n="trinquete"></button>

  <h3 id="spaceTitle"></h3>

  <div id="calendar" class="calendar"></div>
  <div id="hours" class="hours"></div>

  <button onclick="confirmReservation()" data-i18n="confirm"></button>
  <button onclick="sendWhatsApp()" data-i18n="whatsapp"></button>

  <div id="qrBox" class="hidden" style="margin-top:20px;text-align:center">
    <h4 data-i18n="qr"></h4>
    <img id="qrImg">
  </div>

  <div id="adminPanel" class="admin hidden">
    <h3 data-i18n="admin"></h3>
    <button onclick="exportCSV()">Exportar Excel</button>
    <pre id="adminData"></pre>
  </div>
</div>

<script>
let lang = "eu"

const TEXTS = {
  eu: {
    login_title: "Erreserbetarako sarbidea",
    user: "Erabiltzailea",
    pass: "Pasahitza",
    enter: "Sartu",
    fronton: "Frontoia",
    trinquete: "Trinketea",
    confirm: "Erreserba baieztatu",
    whatsapp: "WhatsApp bidez bidali",
    qr: "Erreserbaren QR kodea",
    admin: "Administratzailearen panela",
    error_complete: "Aukeratu frontoia edo trinketea, eguna eta ordutegia.",
    conflict: "Ezin da frontoia eta trinketea ordu berean erreserbatu."
  },
  es: {
    login_title: "Acceso a reservas",
    user: "Usuario",
    pass: "Contraseña",
    enter: "Entrar",
    fronton: "Frontón",
    trinquete: "Trinquete",
    confirm: "Confirmar reserva",
    whatsapp: "Enviar por WhatsApp",
    qr: "QR de la reserva",
    admin: "Panel administrador",
    error_complete: "Selecciona frontón o trinquete, el día y el horario.",
    conflict: "No puedes reservar frontón y trinquete a la misma hora."
  }
}

function setLang(l){
  lang = l
  document.documentElement.lang = l
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    el.textContent = TEXTS[l][el.dataset.i18n]
  })
  document.querySelectorAll("[data-i18n-placeholder]").forEach(el=>{
    el.placeholder = TEXTS[l][el.dataset.i18nPlaceholder]
  })
}

setLang("eu")
</script>

<script>
let currentUser=null, role=null
let space=null, selectedDay=null, selectedHours=[]
let reservations=[]
let lastReservation=null

function formatDate(date){
  const [y,m,d]=date.split("-")
  return lang==="eu" ? `${y}/${m}/${d}` : `${d}/${m}/${y}`
}

function confirmReservation(){
  if(!space || !selectedDay || selectedHours.length===0){
    alert(TEXTS[lang].error_complete)
    return
  }
}
</script>

</body>
</html>
