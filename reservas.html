<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reservas | Larraun Pilota Elkartea</title>

<style>
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f4f4f4;color:#333}
header{background:#222;color:#fff;text-align:center;padding:20px}
.login-box,.reserva-box{max-width:420px;margin:40px auto;background:#fff;padding:25px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.2)}
h2{text-align:center;margin-top:0}
input,button,select{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc}
button{background:#b30000;color:#fff;border:none;font-weight:bold;cursor:pointer}
button:hover{background:#900}
.hidden{display:none}
.tabs{display:flex;gap:10px;margin-bottom:15px}
.tabs button{flex:1;background:#006400}
.tabs button.active{background:#004d00}
.slots{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.slot{padding:10px;border-radius:6px;text-align:center;background:#e0e0e0;cursor:pointer}
.slot.selected{background:#006400;color:#fff}
footer{text-align:center;padding:20px;background:#222;color:#fff;margin-top:40px}
</style>
</head>

<body>

<header>
  <h1>Reservas Frontón y Trinquete</h1>
</header>

<div class="login-box" id="loginBox">
  <h2>Acceso socios / federados</h2>
  <input type="text" id="user" placeholder="Usuario (FITXA)">
  <input type="password" id="pass" placeholder="Contraseña (URTEA)">
  <button onclick="login()">Entrar</button>
  <p id="loginError" style="color:red;display:none">Datos incorrectos</p>
</div>

<div class="reserva-box hidden" id="reservaBox">
  <h2 id="welcome"></h2>

  <div class="tabs">
    <button onclick="setCourt('fronton')" class="active">Frontón</button>
    <button onclick="setCourt('trinquete')">Trinquete</button>
  </div>

  <label>Día:</label>
  <input type="date" id="datePicker">

  <p>Seleccione hasta 1h30 (3 tramos):</p>
  <div class="slots" id="slots"></div>

  <button onclick="confirmReserva()">Confirmar reserva</button>
  <p id="confirmMsg" style="font-weight:bold"></p>
</div>

<footer>
© 2025 Larraun Pilota Elkartea
</footer>

<script>
const users = {
  "P26726": { year:"1985", name:"MIGUEL", phone:"628 30 43 08", email:"" },
  "P14541": { year:"2001", name:"IÑAKI", phone:"684368779", email:"galarzainaki@gmail.com" }
};

function normalizePhone(raw){
  if(!raw) return "";
  const digits = raw.replace(/\D/g,"");
  return digits.substring(0,9);
}

let currentUser=null;
function login(){
  const u=document.getElementById("user").value.trim();
  const p=document.getElementById("pass").value.trim();
  if(users[u] && users[u].year===p){
    currentUser={...users[u], user:u};
    currentUser.phone=normalizePhone(currentUser.phone);
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("reservaBox").classList.remove("hidden");
    document.getElementById("welcome").innerText="Hola, "+currentUser.name;
  } else {
    document.getElementById("loginError").style.display="block";
  }
}

let selectedCourt="fronton";
let selectedSlots=[];

function setCourt(c){
  selectedCourt=c;
  document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
}

function buildSlots(){
  const container=document.getElementById("slots");
  container.innerHTML="";
  selectedSlots=[];
  for(let h=8;h<22;h++){
    ["00","30"].forEach(m=>{
      const label=(h<10?"0":"")+h+":"+m;
      const div=document.createElement("div");
      div.className="slot";
      div.innerText=label;
      div.onclick=()=>toggleSlot(div,label);
      container.appendChild(div);
    });
  }
}

function toggleSlot(el,label){
  if(el.classList.contains("selected")){
    el.classList.remove("selected");
    selectedSlots=selectedSlots.filter(s=>s!==label);
  } else {
    if(selectedSlots.length>=3){
      alert("Máximo 1h30 por día");
      return;
    }
    el.classList.add("selected");
    selectedSlots.push(label);
  }
}

function confirmReserva(){
  if(selectedSlots.length===0){
    alert("Seleccione al menos un tramo");
    return;
  }
  const code=Math.floor(100000+Math.random()*900000);
  document.getElementById("confirmMsg").innerText =
    "Reserva confirmada. Código: "+code+
    (currentUser.phone ? " · WhatsApp a "+currentUser.phone : "");
}

document.getElementById("datePicker").valueAsDate=new Date();
buildSlots();
</script>

</body>
</html>
