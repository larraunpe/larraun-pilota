<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8" />
<title>Larraun Kartela</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>

/* ================= BASE ================= */

body{
  margin:0;
  background:#1b4d31;
  font-family:"Trebuchet MS","Arial Black",sans-serif;
}

.exportar{
  text-align:center;
  margin:18px;
}

/* ================= P√ÅGINA ================= */

.pagina{
  width:900px;
  height:1400px;
  margin:25px auto;

  display:flex;
  flex-direction:column;

  position:relative;
  background:#3f8159;
  overflow:hidden;
}

/* textura */
.pagina::before{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    repeating-linear-gradient(45deg,rgba(255,255,255,.02) 0 2px,rgba(0,0,0,.03) 2px 4px);
}

/* ================= CHAPAS ================= */

.chapa{
  height:12px;
  background:#000;
  flex-shrink:0;
}

/* ================= HEADER ================= */

.header{
  flex:0 0 150px;

  background:#2448b5;
  display:flex;
  align-items:center;
  justify-content:space-between;

  padding:0 20px;
  color:#fff;

  box-shadow:
    inset 0 8px 10px rgba(255,255,255,.3),
    inset 0 -12px 16px rgba(0,0,0,.6);
}

.header img{
  height:60px;
}

/* ===== t√≠tulo curvado ===== */

.titulo-curvo{
  width:500px;
  height:130px;
}

.titulo-curvo text{
  fill:white;
  font-weight:900;
  font-size:38px;
  letter-spacing:2px;
}

/* pelota */
.pelota-svg{
  fill:white;
  stroke:#ccc;
  stroke-width:2;
}

/* ================= CONTENIDO ================= */

.contenido{
  flex:1;
  padding:14px 18px;
  overflow:hidden;
}

/* ================= BLOQUES ================= */

.bloque{
  margin-bottom:16px;
}

.bloque h2{
  text-align:center;
  color:white;
  margin:10px 0;
}

/* ================= PARTIDOS ================= */

.grupo{
  background:white;
  border-radius:10px;
  overflow:hidden;
  margin-top:6px;
}

.grupo-header{
  padding:8px 14px;
  font-weight:bold;
  color:#fff;
  background:#2448b5;
}

.grupo-header.rojo{
  background:#b00000;
}

.linea{
  display:flex;
  gap:8px;
  padding:8px 10px;
  border-top:1px solid #ddd;
  font-weight:900;
  font-size:14px;
}

.zkia{width:26px}
.etxekoa{color:#2448b5}
.kanpokoa{color:#b00000}
.lehiaketa{margin-left:auto}

/* ================= FOOTER ================= */

.footer{
  flex:0 0 240px;
  display:flex;
  flex-direction:column;
}

.pie-gris{
  background:#2f2f2f;
  padding:8px;
}

.suelo{
  background:#6b6b6b;
  flex:1;
}

/* logos */

.logos-grid{
  display:grid;
  grid-template-columns:repeat(10,1fr);
  gap:8px;
}

.logo-item{
  background:#fff;
  padding:6px;
  border-radius:6px;
}

.logo-item img{
  width:100%;
  height:36px;
  object-fit:contain;
}

/* pelotazos */

.pelotazos{
  position:absolute;
  inset:0;
  pointer-events:none;
}

.pelota{
  position:absolute;
  border-radius:50%;
  background:#000;
}

</style>
</head>

<body>

<div class="exportar">
<button onclick="exportar()">üì∏ DESKARGATU JPG</button>
</div>

<div id="paginas"></div>

<script>

/* ================= LOGOS ================= */

const LOGOS=[/* mismos logos */];

function logosHTML(){
  return LOGOS.map(f =>
   `<div class="logo-item"><img src="/images/patrocinio/${f}"></div>`
  ).join("");
}

/* ================= HEADER SVG ================= */

function headerCurvo(){
return `
<svg viewBox="0 0 500 130" class="titulo-curvo">
  <defs>
    <path id="curva" d="M40,100 Q250,10 460,100" />
  </defs>

  <text text-anchor="middle">
    <textPath href="#curva" startOffset="50%">
      LARRAUN PILOTA ELKARTEA
    </textPath>
  </text>

  <circle cx="250" cy="85" r="18" class="pelota-svg"/>
</svg>`;
}

/* ================= CREAR P√ÅGINA ================= */

function nuevaPagina(){

  const p=document.createElement("div");
  p.className="pagina";

  p.innerHTML=`
    <div class="pelotazos"></div>

    <div class="chapa"></div>

    <div class="header">
      <img src="/images/logo-larraun.png">
      ${headerCurvo()}
      <img src="/images/logo-fnp.png">
    </div>

    <div class="chapa"></div>

    <div class="contenido"></div>

    <div class="chapa"></div>

    <div class="footer">
      <div class="pie-gris">
        <div class="logos-grid">${logosHTML()}</div>
      </div>
      <div class="suelo"></div>
    </div>
  `;

  document.getElementById("paginas").appendChild(p);

  return p;
}

/* ================= MEDIR ================= */

function alturaBloque(el){
  el.style.position="absolute";
  el.style.visibility="hidden";
  document.body.appendChild(el);
  const h=el.getBoundingClientRect().height;
  document.body.removeChild(el);
  return h;
}

/* ================= FILTRO DESCANSOS ================= */

function limpiar(data){
  return data.filter(p=>{
    const k=(p.kanpokoak||"").toLowerCase();
    return !k.includes("descanso") && !k.includes("atseden");
  });
}

/* ================= PAGINADOR PERFECTO ================= */

Promise.all([
fetch("/data/cartelera-larraun.json").then(r=>r.json()),
fetch("/data/partidos-no-oficiales.json").then(r=>r.json())
]).then(([oficiales,noOficiales])=>{

const bloques=[
{titulo:"ORDUTEGIAK",data:limpiar(oficiales)},
{titulo:"BESTE TXAPELKETAK OFIZIALAK",data:limpiar(noOficiales.filter(p=>p.ofiziala==="true"))},
{titulo:"TXAPELKETAK EZ OFIZIALAK",data:limpiar(noOficiales.filter(p=>p.ofiziala!=="true"))}
];

let pagina=nuevaPagina();
let cont=pagina.querySelector(".contenido");
let max=cont.getBoundingClientRect().height;
let usado=0;

bloques.forEach(b=>{

  if(!b.data.length) return;

  const titulo=document.createElement("div");
  titulo.className="bloque";
  titulo.innerHTML=`<h2>${b.titulo}</h2>`;

  let h=alturaBloque(titulo);

  if(usado+h>max){ pagina=nuevaPagina(); cont=pagina.querySelector(".contenido"); max=cont.getBoundingClientRect().height; usado=0;}

  cont.appendChild(titulo);
  usado+=h;

  b.data.forEach(p=>{

    const grupo=document.createElement("div");
    grupo.className="grupo";

    grupo.innerHTML=`
      <div class="grupo-header">üìÖ ${p.fecha} | ‚è∞ ${p.hora} | üìç ${p.fronton}</div>
      <div class="linea">
        <div class="zkia">${p.zkia}</div>
        <div class="etxekoa">${p.etxekoa}</div>
        <div class="kanpokoa">${p.kanpokoak}</div>
        <div class="lehiaketa">${p.lehiaketa}</div>
      </div>`;

    h=alturaBloque(grupo);

    if(usado+h>max){
      pagina=nuevaPagina();
      cont=pagina.querySelector(".contenido");
      max=cont.getBoundingClientRect().height;
      usado=0;
    }

    cont.appendChild(grupo);
    usado+=h;
  });
});

});

/* ================= EXPORTAR ================= */

async function exportar(){
const paginas=[...document.querySelectorAll(".pagina")];
let i=1;
for(const p of paginas){
const canvas=await html2canvas(p,{scale:2,useCORS:true});
const a=document.createElement("a");
a.download=`kartela_${i++}.jpg`;
a.href=canvas.toDataURL("image/jpeg",0.95);
a.click();
}
}

</script>
</body>
</html>
