<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8"/>
<title>Larraun Kartela</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>

/* ================= BASE ================= */

body{
  margin:0;
  background:#1b4d31;
  font-family:"Trebuchet MS","Arial Black",sans-serif;
}

.exportar{text-align:center;margin:18px}

/* ================= P√ÅGINA ================= */

.pagina{
  width:900px;
  height:1400px;
  margin:25px auto;
  display:flex;
  flex-direction:column;
  position:relative;
  overflow:hidden;
  background:#3f8159;
}

/* ================= PELOTAZOS ================= */

.pelotazos{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index:0;
}

.pelota{
  position:absolute;
  border-radius:50%;
  background:#000;
  opacity:.18;
}

/* ================= CHAPAS ================= */

.chapa{
  height:12px;
  background:#000;
  flex-shrink:0;
  z-index:1;
}

/* ================= HEADER (colch√≥n restaurado) ================= */

.header{
  height:150px;
  flex-shrink:0;

  background:#2448b5;

  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;

  z-index:1;

  box-shadow:
    inset 0 10px 14px rgba(255,255,255,.35),
    inset 0 -14px 18px rgba(0,0,0,.65);
}

.header img{height:60px}

/* ===== t√≠tulo curvo ===== */

.titulo-curvo{
  width:560px;
  height:130px;
}

.titulo-curvo text{
  fill:#fff;
  font-size:38px;
  font-weight:900;
  letter-spacing:2px;
}

/* ================= CONTENIDO ================= */

.contenido{
  flex:1;
  padding:14px 18px;
  overflow:hidden;
  z-index:1;
}

/* ================= BLOQUES ================= */

.bloque{margin-bottom:14px}
.bloque h2{text-align:center;color:#fff;margin:10px 0}

/* ================= PARTIDOS ================= */

.grupo{
  background:#fff;
  border-radius:10px;
  overflow:hidden;
  margin-top:6px;
}

.grupo-header{
  background:#2448b5;
  color:#fff;
  font-weight:bold;
  padding:8px 12px;
}

.grupo-header.rojo{background:#b00000}

.linea{
  display:flex;
  gap:8px;
  padding:7px 10px;
  border-top:1px solid #ddd;
  font-weight:900;
  font-size:14px;
}

.zkia{width:26px}
.etxekoa{color:#2448b5}
.kanpokoa{color:#b00000}
.lehiaketa{margin-left:auto}

/* ================= FOOTER (1:2 correcto) ================= */

.footer{flex-shrink:0;display:flex;flex-direction:column}

.pie-gris{
  height:80px;
  background:#2f2f2f;
  padding:6px;
}

.suelo{
  height:160px;
  background:#6b6b6b;
}

.logos-grid{
  display:grid;
  grid-template-columns:repeat(10,1fr);
  gap:6px;
}

.logo-item{
  background:#fff;
  padding:4px;
  border-radius:6px;
}

.logo-item img{
  width:100%;
  height:28px;
  object-fit:contain;
}

</style>
</head>

<body>

<div class="exportar">
<button onclick="exportar()">üì∏ DESKARGATU JPG</button>
</div>

<div id="paginas"></div>

<script>

/* ================= CONFIG ESTABLE ================= */
/* altura real disponible del contenido */
const CONTENIDO_MAX = 930;

/* ================= LOGOS ================= */

const LOGOS=[
"aliprox.jpg","arbeondo.jpg","asadorepeleta.jpg","barainhoa.jpg","kotxera.jpg"
];

function logosHTML(){
return LOGOS.map(f=>`<div class="logo-item"><img src="/images/patrocinio/${f}"></div>`).join("");
}

/* ================= HEADER SVG ================= */

function headerCurvo(){
return `
<svg viewBox="0 0 600 160" class="titulo-curvo">
<defs>
<path id="arco" d="M40,120 Q300,10 560,120"/>
</defs>

<text text-anchor="middle">
<textPath href="#arco" startOffset="50%">
LARRAUN PILOTA ELKARTEA
</textPath>
</text>

<g transform="translate(300,105)">
<circle r="20" fill="white" stroke="#ccc" stroke-width="2"/>
<path d="M-16,-8 Q0,-14 16,-8" stroke="#c40000" stroke-width="2" fill="none"/>
<path d="M-16,8 Q0,14 16,8" stroke="#c40000" stroke-width="2" fill="none"/>
<text y="6" text-anchor="middle" font-size="16" fill="black">‚ú¢</text>
</g>
</svg>`;
}

/* ================= P√ÅGINA ================= */

function nuevaPagina(){

const p=document.createElement("div");
p.className="pagina";

p.innerHTML=`
<div class="pelotazos"></div>

<div class="chapa"></div>

<div class="header">
<img src="/images/logo-larraun.png">
${headerCurvo()}
<img src="/images/logo-fnp.png">
</div>

<div class="chapa"></div>

<div class="contenido"></div>

<div class="chapa"></div>

<div class="footer">
<div class="pie-gris"><div class="logos-grid">${logosHTML()}</div></div>
<div class="suelo"></div>
</div>
`;

document.getElementById("paginas").appendChild(p);

generarPelotazos(p);

return p;
}

/* ================= PELOTAZOS ================= */

function generarPelotazos(p){
const cont=p.querySelector(".pelotazos");
for(let i=0;i<1800;i++){
const d=document.createElement("div");
const s=Math.random()*3+2;
d.className="pelota";
d.style.width=d.style.height=s+"px";
d.style.left=Math.random()*900+"px";
d.style.top=Math.random()*1400+"px";
cont.appendChild(d);
}
}

/* ================= UTIL ================= */

function normalizaHora(h){
return h ? h.slice(0,5) : "00:00";
}

function limpiar(data){
return data.filter(p=>!(p.kanpokoak||"").toLowerCase().includes("descanso"));
}

function alturaBloque(el){
el.style.position="absolute";
el.style.visibility="hidden";
document.body.appendChild(el);
const h=el.offsetHeight;
document.body.removeChild(el);
return h;
}

/* ================= CARGA Y PINTA ================= */

Promise.all([
fetch("/data/cartelera-larraun.json").then(r=>r.json())
]).then(([oficiales])=>{

let pagina=nuevaPagina();
let cont=pagina.querySelector(".contenido");
let usado=0;

limpiar(oficiales).forEach(p=>{

const grupo=document.createElement("div");
grupo.className="grupo";

grupo.innerHTML=`
<div class="grupo-header">üìÖ ${p.fecha} | ‚è∞ ${normalizaHora(p.hora)} | üìç ${p.fronton}</div>
<div class="linea">
<div class="zkia">${p.zkia}</div>
<div class="etxekoa">${p.etxekoa}</div>
<div class="kanpokoa">${p.kanpokoak}</div>
<div class="lehiaketa">${p.lehiaketa}</div>
</div>`;

const h=alturaBloque(grupo);

if(usado+h>CONTENIDO_MAX){
pagina=nuevaPagina();
cont=pagina.querySelector(".contenido");
usado=0;
}

cont.appendChild(grupo);
usado+=h;

});

});

/* ================= EXPORTAR ================= */

async function exportar(){
const paginas=[...document.querySelectorAll(".pagina")];
let i=1;
for(const p of paginas){
const canvas=await html2canvas(p,{scale:2});
const a=document.createElement("a");
a.download=`kartela_${i++}.jpg`;
a.href=canvas.toDataURL("image/jpeg",0.95);
a.click();
}
}

</script>
</body>
</html>
