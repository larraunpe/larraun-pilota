<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Larraun Kartela</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>

/* ================= BASE ================= */

body{
  margin:0;
  font-family:"Trebuchet MS","Arial Black",sans-serif;
  background:#1b4d31;
}

/* ================= CARTEL ================= */

.cartel{
  width:900px;
  margin:20px auto;
  background:#3c7a52; /* verde m√°s claro realista */
  border-radius:12px;
  overflow:hidden;
  position:relative;
}

/* textura hormig√≥n */
.cartel::before{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    repeating-linear-gradient(45deg,rgba(255,255,255,.02) 0 2px,rgba(0,0,0,.03) 2px 4px),
    radial-gradient(circle at 30% 30%,rgba(0,0,0,.15) 0 3px,transparent 4px);
}

/* ================= PELOTAZOS ================= */

.pelotazos{
  position:absolute;
  inset:0;
  pointer-events:none;
}

.pelota{
  position:absolute;
  border-radius:50%;
  background:#000;
}

/* ================= CHAPA NEGRA ================= */

.chapa{
  height:12px;
  background:#000;
}

/* ================= HEADER COLCH√ìN ================= */

.header{
  background:#2448b5;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 20px;

  box-shadow:
    inset 0 8px 12px rgba(255,255,255,.3),
    inset 0 -12px 14px rgba(0,0,0,.6);
}

.header img{height:60px}

.header h1{
  letter-spacing:2px;
}

/* ================= BLOQUES ================= */

.bloque{padding:18px}

.bloque h2{
  text-align:center;
  color:#fff;
  letter-spacing:2px;
}

/* ================= GRUPOS ================= */

.grupo{
  background:#fff;
  border-radius:10px;
  margin-top:12px;
  overflow:hidden;
  box-shadow:0 4px 10px rgba(0,0,0,.4);
}

.grupo-header{
  background:#2448b5;
  color:#fff;
  padding:8px 14px;
  font-weight:bold;
}

.grupo-header.rojo{
  background:#b00000;
}

.linea{
  display:flex;
  padding:8px 14px;
  gap:10px;
  border-top:1px solid #ddd;
  font-weight:900;
}

.zkia{width:30px}
.etxekoa{color:#2448b5}
.kanpokoa{color:#b00000}

.lehiaketa{
  margin-left:auto;
  text-align:right;
}

.fase{
  font-weight:900;
}

/* ================= PIE ================= */

.patrocinadores{
  background:#2e2e2e;
  padding:14px;
}

.suelo{
  background:#777;
  padding:20px;
}

.logos-grid{
  display:grid;
  grid-template-columns:repeat(10,1fr);
  gap:10px;
}

.logo-item{
  background:#fff;
  padding:6px;
  border-radius:6px;
}

.logo-item img{
  width:100%;
  height:40px;
  object-fit:contain;
}

/* ================= BOT√ìN ================= */

.exportar{
  text-align:center;
  margin:14px;
}

button{
  padding:12px 20px;
  background:#2448b5;
  color:#fff;
  border:none;
  border-radius:20px;
  cursor:pointer;
}

</style>
</head>

<body>

<div class="exportar">
<button onclick="exportarPaginas()">üì∏ DESKARGATU JPG</button>
</div>

<div class="cartel" id="kartela">

<div class="pelotazos"></div>

<div class="chapa"></div>

<div class="header">
<img src="/images/logo-larraun.png">
<h1>LARRAUN PILOTA ELKARTEA</h1>
<img src="/images/logo-fnp.png">
</div>

<div class="chapa"></div>

<div id="content"></div>

<div class="chapa"></div>

<div class="patrocinadores">
<div class="logos-grid" id="logos"></div>
</div>

<div class="suelo"></div>

</div>

<script>

/* ================= PELOTAZOS ================= */

function generarPelotazos(){
  const cont=document.querySelector(".pelotazos");
  const w=900;
  const h=document.getElementById("kartela").offsetHeight;

  for(let i=0;i<2500;i++){
    const d=document.createElement("div");
    d.className="pelota";
    const s=Math.random()*6+3;
    d.style.width=d.style.height=s+"px";
    d.style.left=Math.random()*w+"px";
    d.style.top=Math.random()*h+"px";
    d.style.opacity=Math.random()*0.08+0.05;
    cont.appendChild(d);
  }
}

/* ================= FASES ================= */

let fases={};
fetch("/data/fases.json").then(r=>r.json()).then(d=>fases=d);

function formatearLehiaketa(t){
  if(!t) return "";
  const k=Object.keys(fases).find(f=>t.toUpperCase().startsWith(f));
  if(!k) return t;
  return `<span class="fase">${k}</span> (${t.slice(k.length).trim()})`;
}

/* ================= RENDER PARTIDOS (TU L√ìGICA ORIGINAL) ================= */

Promise.all([
fetch("/data/cartelera-larraun.json").then(r=>r.json()),
fetch("/data/partidos-no-oficiales.json").then(r=>r.json())
]).then(([oficiales,noOficiales])=>{

const bloques=[
{titulo:"ORDUTEGIAK",data:oficiales},
{titulo:"BESTE TXAPELKETAK OFIZIALAK",data:noOficiales.filter(p=>String(p.ofiziala)==="true")},
{titulo:"TXAPELKETAK EZ OFIZIALAK",data:noOficiales.filter(p=>String(p.ofiziala)!=="true")}
];

const cont=document.getElementById("content");

bloques.forEach(b=>{
if(!b.data.length) return;

const bloque=document.createElement("div");
bloque.className="bloque";
bloque.innerHTML=`<h2>${b.titulo}</h2>`;
cont.appendChild(bloque);

b.data.forEach(p=>{
const esLocal=/lekunberri|aldatz/i.test(p.fronton||"");

bloque.innerHTML+=`
<div class="grupo">
<div class="grupo-header ${!esLocal?'rojo':''}">
üìÖ ${p.fecha} | ‚è∞ ${p.hora} | üìç ${p.fronton}
</div>
<div class="linea">
<div class="zkia">${p.zkia}</div>
<div class="etxekoa">${p.etxekoa||""}</div>
<div class="kanpokoa">${p.kanpokoak||""}</div>
<div class="lehiaketa">${formatearLehiaketa(p.lehiaketa)}</div>
</div>
</div>`;
});

});

setTimeout(generarPelotazos,300);

});

/* ================= LOGOS ================= */

const LOGOS=["aliprox.jpg","arbeondo.jpg","asadorepeleta.jpg"];
const logos=document.getElementById("logos");
LOGOS.forEach(f=>{
logos.innerHTML+=`<div class="logo-item"><img src="/images/patrocinio/${f}"></div>`;
});

/* ================= EXPORTAR MULTIP√ÅGINA ================= */

async function exportarPaginas(){
const canvas=await html2canvas(document.getElementById("kartela"),{scale:2,useCORS:true});
const A4=3508;
let y=0,n=1;

while(y<canvas.height){
const slice=document.createElement("canvas");
slice.width=canvas.width;
slice.height=Math.min(A4,canvas.height-y);
slice.getContext("2d").drawImage(canvas,0,y,canvas.width,slice.height,0,0,canvas.width,slice.height);

const a=document.createElement("a");
a.download=`kartela_${n++}.jpg`;
a.href=slice.toDataURL("image/jpeg",0.95);
a.click();

y+=A4;
}
}

</script>

</body>
</html>
