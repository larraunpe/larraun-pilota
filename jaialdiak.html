<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jaialdiak â€“ Larraun Pilota Elkartea</title>

<style>
body{
  font-family: Arial, Helvetica, sans-serif;
  background:#f4f4f4;
  padding:20px;
}

table{
  width:100%;
  max-width:900px;
  margin:auto;
  border-collapse:collapse;
  background:#fff;
  box-shadow:0 4px 10px rgba(0,0,0,.2);
}

thead{
  background:#7cb342;
  color:#000;
}

th, td{
  padding:10px;
  border:1px solid #ccc;
  text-align:center;
}

th{
  font-weight:900;
}

input{
  width:100%;
  border:none;
  background:#e8f5e9;
  padding:6px;
  font-size:1em;
}

input:focus{
  outline:2px solid #7cb342;
}

.whatsapp{
  font-size:.85em;
}
.whatsapp a{
  text-decoration:none;
}
</style>
</head>

<body>

<h1 style="text-align:center;color:#33691e;">JAIALDIAK</h1>

<table>
  <thead>
  <tr>
    <th>EGUNA</th>
    <th>ORDUA</th>
    <th>LEKUA</th>
    <th>ZB</th>
    <th>SENIOR</th>
    <th>EPAILEA(K)</th>
  </tr>
</thead>
<tbody id="taula"></tbody>

</table>

<script>
const SENIOR_RE = /(NAGUSI|HELDUA|SENIOR|ESPAINA)/i;

function normalizaHora(h){
  if(!h) return "00:00";
  return h.slice(0,5);
}

Promise.all([
  fetch("data/cartelera-larraun.json").then(r=>r.json()),
  fetch("data/partidos-no-oficiales.json").then(r=>r.json())
]).then(([oficiales, noOficiales]) => {

  const data = [
    ...oficiales.map(p => ({ ...p, ofiziala:true })),
    ...noOficiales
  ];

  const jaialdiak = {};

  data.forEach(p => {

    /* SOLO Lekunberri o Aldatz */
    if(!/lekunberri|aldatz/i.test(p.fronton||"")) return;

    const hora = normalizaHora(p.hora);
    const key = `${p.fecha}|${hora}|${p.fronton}`;

    if(!jaialdiak[key]){
      jaialdiak[key] = {
        fecha: p.fecha,
        hora: hora,
        fronton: p.fronton,
        zb: 0,
        senior: "EZ"
      };
    }

    jaialdiak[key].zb++;

    const testua = `${p.lehiaketa||""} ${p.modalitatea||""}`;
    if(SENIOR_RE.test(testua)){
      jaialdiak[key].senior = "BAI";
    }
  });

  const tbody = document.getElementById("taula");

  Object.values(jaialdiak)
    .sort((a,b)=> new Date(a.fecha+" "+a.hora) - new Date(b.fecha+" "+b.hora))
    .forEach(j => {

      const id = `epailea_${j.fecha}_${j.hora}_${j.fronton}`;
      const guardado = localStorage.getItem(id) || "";

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${j.fecha}</td>
        <td>${j.hora}</td>
        <td>${j.fronton}</td>
        <td><strong>${j.zb}</strong></td>
        <td><strong>${j.senior}</strong></td>
        <td>
          <input value="${guardado}"
            oninput="localStorage.setItem('${id}', this.value)">
        </td>
      `;
      tbody.appendChild(tr);
    });
});
</script>

</body>
</html>
