<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<title>Larraun Kartela Pro</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>

/* ================= BASE ================= */

body{
  margin:0;
  background:#1b4d31;
  font-family:"Trebuchet MS","Arial Black",system-ui,sans-serif;
}

.exportar{
  text-align:center;
  margin:14px;
}

button{
  background:#0d47a1;
  color:#fff;
  border:none;
  padding:10px 18px;
  border-radius:20px;
  cursor:pointer;
  font-weight:bold;
}

/* ================= PAGINA ================= */

.pagina{
  width:900px;
  min-height:1400px;
  margin:20px auto;
  position:relative;
  background:#2a623f;
  box-shadow:0 12px 30px rgba(0,0,0,.5);
  overflow:hidden;
}

/* textura hormig√≥n + p√≥ster */
.pagina::before{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    repeating-linear-gradient(45deg, rgba(255,255,255,.03) 0 2px, rgba(0,0,0,.03) 2px 4px),
    radial-gradient(circle, transparent 60%, rgba(0,0,0,.4));
  z-index:0;
}

/* ================= PELOTAZOS ================= */

.pelotazos{
  position:absolute;
  inset:0;
  z-index:0;
}

.pelota{
  position:absolute;
  border-radius:50%;
  background:#000;
}

/* ================= HEADER ================= */

.header{
  background:#3f51b5;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 20px;
  box-shadow:
    inset 0 8px 12px rgba(255,255,255,.35),
    inset 0 -10px 12px rgba(0,0,0,.55);
}

.header h1{
  color:#fff;
  letter-spacing:3px;
}

.chapa{height:10px;background:#000}

/* ================= CONTENIDO ================= */

.contenido{
  padding:20px;
  position:relative;
  z-index:2;
}

.bloque{margin-top:24px}
.bloque h2{
  color:#fff;
  text-align:center;
  letter-spacing:2px;
}

/* ================= PARTIDOS ================= */

.grupo{
  background:#fff;
  border-radius:10px;
  margin-top:10px;
  box-shadow:0 5px 12px rgba(0,0,0,.3);
  overflow:hidden;
}

.grupo-header{
  padding:10px;
  color:#fff;
  font-weight:bold;
  background:#0d47a1;
}

.grupo-header.rojo{
  background:#b00000;
}

.linea{
  display:flex;
  gap:10px;
  padding:8px 12px;
  border-top:1px solid #ddd;
  font-weight:900;
  font-size:.95em;
}

.zkia{width:28px}
.etxekoa{color:#0d47a1}
.kanpokoa{color:#b71c1c}
.lehiaketa{margin-left:auto;text-align:right}
.fase{font-weight:bold}

/* ================= PIE ================= */

.footer{
  padding:16px;
  background:#9e9e9e;
  margin-top:30px;
}

.logos-grid{
  display:grid;
  grid-template-columns:repeat(10,1fr);
  gap:6px;
}

.logo-item{
  background:#fff;
  padding:5px;
  border-radius:6px;
}

.logo-item img{
  width:100%;
  height:34px;
  object-fit:contain;
}

</style>
</head>

<body>

<div class="exportar">
<button onclick="exportarPaginas()">üì∏ DESKARGATU JPG GUZTIAK</button>
</div>

<div id="paginas"></div>

<script>

/* ================= PELOTAZOS ================= */

function generarPelotazos(pagina){

  const cont=pagina.querySelector(".pelotazos");

  for(let i=0;i<2200;i++){
    const d=document.createElement("div");
    d.className="pelota";

    const s=Math.random()*8+3;

    d.style.width=d.style.height=s+"px";
    d.style.left=Math.random()*900+"px";
    d.style.top=Math.random()*1400+"px";
    d.style.opacity=Math.random()*0.10+0.05;

    cont.appendChild(d);
  }
}

/* ================= CREAR PAGINA ================= */

function crearPagina(){

  const p=document.createElement("div");
  p.className="pagina";

  p.innerHTML=`
    <div class="pelotazos"></div>

    <div class="header">
      <img src="/images/logo-larraun.png" height="60">
      <h1>LARRAUN PILOTA ELKARTEA</h1>
      <img src="/images/logo-fnp.png" height="60">
    </div>
    <div class="chapa"></div>

    <div class="contenido"></div>

    <div class="footer">
      <div class="logos-grid" id="logos"></div>
    </div>
  `;

  generarPelotazos(p);

  document.getElementById("paginas").appendChild(p);

  return p;
}

/* ================= LOGOS ================= */

const LOGOS=[ /* tus logos reales */
"aliprox.jpg","arbeondo.jpg","asadorepeleta.jpg","barainhoa.jpg","kotxera.jpg"
];

function pintarLogos(pagina){
  const grid=pagina.querySelector("#logos");
  LOGOS.forEach(f=>{
    grid.innerHTML+=`<div class="logo-item"><img src="/images/patrocinio/${f}"></div>`;
  });
}

/* ================= PARTIDOS ================= */

function normalizaHora(h){return h?h.slice(0,5):"00:00"}

function agrupar(data){
  const g={};
  data.forEach(p=>{
    const k=`${p.fecha}|${p.hora}|${p.fronton}`;
    if(!g[k]) g[k]=[];
    g[k].push(p);
  });
  return g;
}

async function cargarDatos(){

  const oficiales=await fetch("/data/cartelera-larraun.json").then(r=>r.json());
  const noOficiales=await fetch("/data/partidos-no-oficiales.json").then(r=>r.json());

  const todos=[...oficiales,...noOficiales];

  const pagina=crearPagina();
  const cont=pagina.querySelector(".contenido");

  const grupos=agrupar(todos);

  Object.values(grupos).forEach(partidos=>{

    const p0=partidos[0];

    const grupo=document.createElement("div");
    grupo.className="grupo";

    grupo.innerHTML=`
      <div class="grupo-header">
        üìÖ ${p0.fecha} | ‚è∞ ${normalizaHora(p0.hora)} | üìç ${p0.fronton}
      </div>
      ${partidos.map(p=>`
        <div class="linea">
          <div class="zkia">${p.zkia}</div>
          <div class="etxekoa">${p.etxekoa}</div>
          <div class="kanpokoa">${p.kanpokoak}</div>
          <div class="lehiaketa">${p.lehiaketa||""}</div>
        </div>
      `).join("")}
    `;

    cont.appendChild(grupo);

  });

  pintarLogos(pagina);
}

window.onload=cargarDatos;

/* ================= EXPORTAR ================= */

async function exportarPaginas(){

  const paginas=[...document.querySelectorAll(".pagina")];

  let n=1;
  for(const p of paginas){
    const canvas=await html2canvas(p,{scale:2,useCORS:true});
    const a=document.createElement("a");
    a.download=`kartela_${n++}.jpg`;
    a.href=canvas.toDataURL("image/jpeg",0.95);
    a.click();
  }
}

</script>

</body>
</html>
