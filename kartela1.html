<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8">
<title>Larraun Kartela FINAL</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>

/* =====================================================
   CONFIG MEDIDAS (NO TOCAR)
===================================================== */

:root{
  --pageH:1400px;
  --headerH:150px;
  --footerH:260px;
  --chapaH:12px;
  --contenidoH:calc(var(--pageH) - var(--headerH) - var(--footerH) - var(--chapaH)*2);
}

/* =====================================================
   BASE
===================================================== */

body{
  margin:0;
  background:#1b4d31;
  font-family:"Trebuchet MS","Arial Black",sans-serif;
}

.exportar{
  text-align:center;
  margin:20px;
}

/* =====================================================
   PAGINA
===================================================== */

.pagina{
  width:900px;
  height:var(--pageH);
  margin:30px auto;
  display:flex;
  flex-direction:column;
  position:relative;
  overflow:hidden;

  background:#3f8159;
}

/* textura front√≥n */
.pagina::before{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:
    repeating-linear-gradient(45deg,rgba(255,255,255,.03) 0 2px,rgba(0,0,0,.05) 2px 4px);
}

/* =====================================================
   HEADER (COLCH√ìN AZUL)
===================================================== */

.header{
  height:var(--headerH);
  background:#2448b5;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;

  box-shadow:
    inset 0 10px 14px rgba(255,255,255,.35),
    inset 0 -14px 18px rgba(0,0,0,.7);
}

.header img{height:60px}

/* t√≠tulo curvo */
.titulo{
  width:560px;
  height:120px;
}

/* =====================================================
   CHAPAS
===================================================== */

.chapa{
  height:var(--chapaH);
  background:#000;
}

/* =====================================================
   CONTENIDO
===================================================== */

.contenido{
  height:var(--contenidoH);
  padding:16px 20px;
  overflow:hidden;
}

/* =====================================================
   BLOQUES
===================================================== */

.bloque{margin-bottom:18px}

.bloque h2{
  color:#fff;
  text-align:center;
  margin:10px 0;
}

/* =====================================================
   PARTIDOS
===================================================== */

.grupo{
  background:#fff;
  border-radius:10px;
  overflow:hidden;
  margin-top:6px;
}

.grupo-header{
  background:#2448b5;
  color:#fff;
  padding:8px 14px;
  font-weight:bold;
}

.grupo-header.rojo{
  background:#b00000;
}

.linea{
  display:flex;
  gap:8px;
  padding:7px 10px;
  border-top:1px solid #ddd;
  font-weight:900;
}

.zkia{width:28px}
.etxekoa{color:#2448b5}
.kanpokoa{color:#b00000}
.lehiaketa{margin-left:auto}

/* =====================================================
   FOOTER
===================================================== */

.footer{
  height:var(--footerH);
  display:flex;
  flex-direction:column;
}

.colchon{
  height:130px;
  background:#2f2f2f;
  padding:10px;
}

.suelo{
  flex:1;
  background:#6b6b6b;
}

.logos-grid{
  display:grid;
  grid-template-columns:repeat(10,1fr);
  gap:8px;
}

.logo-item{
  background:#fff;
  padding:6px;
  border-radius:6px;
}

.logo-item img{
  width:100%;
  height:34px;
  object-fit:contain;
}

/* =====================================================
   PELOTAZOS
===================================================== */

.pelotazos{
  position:absolute;
  inset:0;
  pointer-events:none;
}

.pelota{
  position:absolute;
  background:#000;
  border-radius:50%;
}

</style>
</head>

<body>

<div class="exportar">
<button onclick="exportar()">üì∏ DESKARGATU JPG</button>
</div>

<div id="paginas"></div>

<script>

/* =====================================================
   LOGOS
===================================================== */

const LOGOS = [
"aliprox.jpg","arbeondo.jpg","asadorepeleta.jpg","barainhoa.jpg","kotxera.jpg",
"barilargi.jpg","barlekuonberri.jpg","bego√±ajanaridenda.jpg","carniceriaartxueta.jpg",
"carpinteriahnosazpiroz.jpg","construccionesga√±arbe.jpg","construccionesgarciarenasaralegi.jpg",
"construccionesurangasaigos.jpg","fisioterapiaandoniayerdi.jpg","hotelayestaran.jpg",
"iseelectricidad.jpg","kattagorrielkartea.jpg","lacturale.jpg","lagunasesoria.jpg",
"maderasnasorena.jpg","maskarada.jpg","sojonatura.jpg","suacontrol.jpg","urzubi.jpg"
];

function logosHTML(){
  return LOGOS.map(f=>`
    <div class="logo-item">
      <img src="/images/patrocinio/${f}">
    </div>`).join("");
}

/* =====================================================
   CREAR PAGINA
===================================================== */

function nuevaPagina(){

  const p=document.createElement("div");
  p.className="pagina";

  p.innerHTML=`
  <div class="pelotazos"></div>

  <div class="header">

    <img src="/images/logo-larraun.png">

    <div class="titulo">
      <svg viewBox="0 0 560 120">
        <defs>
          <path id="curva" d="M40 95 Q280 10 520 95"/>
        </defs>
        <text fill="white" font-size="36" font-weight="900">
          <textPath href="#curva" startOffset="50%" text-anchor="middle">
            LARRAUN PILOTA ELKARTEA
          </textPath>
        </text>
        <circle cx="280" cy="90" r="18" fill="#fff" stroke="#ccc" stroke-width="2"/>
      </svg>
    </div>

    <img src="/images/logo-fnp.png">

  </div>

  <div class="chapa"></div>
  <div class="contenido"></div>
  <div class="chapa"></div>

  <div class="footer">
    <div class="colchon">
      <div class="logos-grid">${logosHTML()}</div>
    </div>
    <div class="suelo"></div>
  </div>
  `;

  document.getElementById("paginas").appendChild(p);
  pelotazos(p);

  return p;
}

/* =====================================================
   PELOTAZOS
===================================================== */

function pelotazos(p){
  const c=p.querySelector(".pelotazos");
  for(let i=0;i<2000;i++){
    const d=document.createElement("div");
    const s=Math.random()*4+2;
    d.className="pelota";
    d.style.width=d.style.height=s+"px";
    d.style.left=Math.random()*900+"px";
    d.style.top=Math.random()*1400+"px";
    d.style.opacity=Math.random()*0.15+0.05;
    c.appendChild(d);
  }
}

/* =====================================================
   AGRUPAR PARTIDOS + PAGINAR
===================================================== */

function agrupar(data){
  const g={};
  data.forEach(p=>{
    if(/descanso/i.test(p.lehiaketa||"")) return;
    const k=`${p.fecha}|${p.hora}|${p.fronton}`;
    if(!g[k]) g[k]=[];
    g[k].push(p);
  });
  return Object.values(g);
}

function altura(el){
  el.style.position="absolute";
  el.style.visibility="hidden";
  document.body.appendChild(el);
  const h=el.offsetHeight;
  document.body.removeChild(el);
  return h;
}

/* =====================================================
   CARGAR DATOS
===================================================== */

Promise.all([
  fetch("/data/cartelera-larraun.json").then(r=>r.json()),
  fetch("/data/partidos-no-oficiales.json").then(r=>r.json())
]).then(([oficiales,noOficiales])=>{

const bloques=[
{titulo:"ORDUTEGIAK",data:oficiales},
{titulo:"BESTE TXAPELKETAK OFIZIALAK",data:noOficiales.filter(p=>String(p.ofiziala)==="true")},
{titulo:"TXAPELKETAK EZ OFIZIALAK",data:noOficiales.filter(p=>String(p.ofiziala)!=="true")}
];

let pagina=nuevaPagina();
let cont=pagina.querySelector(".contenido");
let usado=0;

bloques.forEach(b=>{

  if(!b.data.length) return;

  const bloque=document.createElement("div");
  bloque.className="bloque";
  bloque.innerHTML=`<h2>${b.titulo}</h2>`;

  agrupar(b.data).forEach(grupo=>{

    const p0=grupo[0];
    const local=/lekunberri|aldatz/i.test(p0.fronton||"");

    const g=document.createElement("div");
    g.className="grupo";

    g.innerHTML=`
      <div class="grupo-header ${!local?'rojo':''}">
      üìÖ ${p0.fecha} | ‚è∞ ${p0.hora} | üìç ${p0.fronton}
      </div>
      ${grupo.map(p=>`
      <div class="linea">
        <div class="zkia">${p.zkia}</div>
        <div class="etxekoa">${p.etxekoa||""}</div>
        <div class="kanpokoa">${p.kanpokoak||""}</div>
        <div class="lehiaketa">${p.lehiaketa||""}</div>
      </div>`).join("")}
    `;

    bloque.appendChild(g);
  });

  const h=altura(bloque);

  if(usado+h>900 && usado!==0){
    pagina=nuevaPagina();
    cont=pagina.querySelector(".contenido");
    usado=0;
  }

  cont.appendChild(bloque);
  usado+=h;
});

});

/* =====================================================
   EXPORTAR
===================================================== */

async function exportar(){
  const pags=[...document.querySelectorAll(".pagina")];
  let i=1;
  for(const p of pags){
    const canvas=await html2canvas(p,{scale:2,useCORS:true});
    const a=document.createElement("a");
    a.download=`kartela_${i++}.jpg`;
    a.href=canvas.toDataURL("image/jpeg",0.95);
    a.click();
  }
}

</script>

</body>
</html>
