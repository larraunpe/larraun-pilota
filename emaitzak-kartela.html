<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8" />
<title>Larraun ‚Äì Emaitzak</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>

/* ================= BASE ================= */

body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#184d33;
}

/* ================= PAGINA ================= */

.pagina{
  width:900px;
  height:1270px;
  margin:auto;
  background:#eef4ff;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* ================= HEADER ================= */

.header{
  height:110px;
  background:linear-gradient(#3d6fe6,#2448b5);
  color:white;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}

.header img{
  position:absolute;
  height:80px;
}

.logo-izq{left:20px}
.logo-der{right:20px}

.footer{
  height:40px;
  background:#444;
  color:white;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:11px;
}

.contenido{
  flex:1;
  padding:6px;
  overflow:hidden;
}

/* ================= FILA (PROPORCION EXACTA) ================= */

.fila{
  display:grid;
  grid-template-columns: 2fr 11fr 4fr 11fr 2fr;
  align-items:center;
  height:82px;
  border-top:1px solid #ddd;
  padding:0 10px;
}

/* ================= LOGOS ================= */

.logo{
  width:60px;
  height:60px;
  object-fit:contain;
}

.fila img:first-child{justify-self:start;}
.fila img:last-child{justify-self:end;}

/* ================= EQUIPOS ================= */

.local, .visit{
  min-width:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  white-space:pre-line;   /* ‚Üê RESPETA LOS SALTOS */
}

.visit{text-align:right;}

.nombre{
  font-weight:900;
  font-size:1.15vw;   /* ‚Üê AUTOESCALA seg√∫n ancho */
  line-height:1.1;
}

.local .nombre{color:#0d47a1;}
.visit .nombre{color:#b71c1c;}

.pelotaris{
  font-size:.65vw;   /* mitad tama√±o real */
  opacity:.6;
}

/* ================= MARCADOR ================= */

.score{
  text-align:center;
  font-size:2.8vw;
  font-weight:900;
}

.blue{color:#0d47a1;}
.red{color:#b71c1c;}

</style>
</head>

<body>

<button onclick="exportar()">üì∏ DESKARGATU JPG</button>
<div id="contenedor"></div>

<script>

/* ================= LOGO ================= */

function logoClub(nombre){
  const n = nombre.split("(")[0]
    .replace(/[.,]/g,"")
    .trim()
    .replace(/\s+/g,"-")
    .toUpperCase();

  if(n.includes("LARRAUN"))
    return `<img class="logo" src="images/logo-larraun.png">`;

  return `<img class="logo" src="images/clubes/${n}.jpg" onerror="this.style.display='none'">`;
}

/* ================= EQUIPO ================= */

function bloqueEquipo(texto, clase){

  const lineas = texto.split(/\r?\n/);

  const principal = lineas[0];
  const detalle = lineas[1] || "";

  return `
    <div class="${clase}">
      <div class="nombre">${principal}</div>
      ${detalle ? `<div class="pelotaris">${detalle}</div>` : ""}
    </div>
  `;
}

/* ================= FILA ================= */

function crearFila(p){

  const [a,b]=(p.tanteoa||"-").split("-");

  const fila=document.createElement("div");
  fila.className="fila";

  fila.innerHTML=`
    ${logoClub(p.etxekoa)}
    ${bloqueEquipo(p.etxekoa,"local")}
    <div class="score"><span class="blue">${a}</span> - <span class="red">${b}</span></div>
    ${bloqueEquipo(p.kanpokoak,"visit")}
    ${logoClub(p.kanpokoak)}
  `;

  return fila;
}

/* ================= FILTRO SEMANAS ================= */

function filtrarSemanas(partidos){

  const hoy = new Date();

  const diaSemana = (hoy.getDay()+6)%7; // lunes=0

  const lunesActual = new Date(hoy);
  lunesActual.setDate(hoy.getDate() - diaSemana);

  const lunesPasado = new Date(lunesActual);
  lunesPasado.setDate(lunesActual.getDate() - 7);

  return partidos.filter(p=>{
    if(!p.fecha) return true;

    const f = new Date(p.fecha);
    return f >= lunesPasado && f <= hoy;
  });
}

/* ================= CARGA ================= */

fetch("data/resultados-larraun.json")
  .then(r=>r.json())
  .then(data=>{

    data = filtrarSemanas(data);

    const pagina=document.createElement("div");
    pagina.className="pagina";

    pagina.innerHTML=`
      <div class="header">
        <img src="images/logo-larraun.png" class="logo-izq">
        <h1>EMAITZAK</h1>
        <img src="images/logo-fnp.png" class="logo-der">
      </div>
      <div class="contenido" id="lista"></div>
      <div class="footer">Larraun Pilota Elkartea</div>
    `;

    contenedor.appendChild(pagina);

    const lista=document.getElementById("lista");

    data.forEach(p=>lista.appendChild(crearFila(p)));
  });

/* ================= EXPORT ================= */

async function exportar(){
 const c = await html2canvas(document.querySelector(".pagina"),{scale:2,useCORS:true});
 const a=document.createElement("a");
 a.href=c.toDataURL("image/jpeg",0.95);
 a.download="emaitzak.jpg";
 a.click();
}

</script>

</body>
</html>
