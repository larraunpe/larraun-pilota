<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8"/>
<title>Larraun â€“ Emaitzak</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>

/* ================= BASE ================= */

body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#184d33;
}

button{
  margin:18px;
  padding:10px 18px;
  cursor:pointer;
}

/* ================= PAGINA ALTURA LIBRE ================= */

.pagina{
  width:900px;
  margin:auto;
  background:#eef4ff;
  display:flex;
  flex-direction:column;
}

.contenido{
  padding:8px;
}

/* ================= HEADER GENERAL ================= */

.header{
  height:110px;
  background:linear-gradient(#3d6fe6,#2448b5);
  color:white;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}

.header img{
  position:absolute;
  height:80px;
}

.logo-izq{left:20px}
.logo-der{right:20px}

.footer{
  height:40px;
  background:#444;
  color:white;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:11px;
}

/* ================= CABECERA PARTIDO ================= */

.partido{
  margin-bottom:6px;
  border-radius:6px;
  overflow:hidden;
  background:white;
}

.partido-header{
  font-size:11px;
  font-weight:800;
  text-align:center;
  padding:4px;
  color:white;
}

.azul{ background:#2f5fd2; }
.rojo{ background:#b71c1c; }

/* ================= FILA 2-11-4-11-2 ================= */

.fila{
  display:grid;
  grid-template-columns: 2fr 11fr 4fr 11fr 2fr;
  align-items:center;
  padding:8px 10px;
  border-top:1px solid #ddd;
}

.fila > *{ min-width:0; }

/* ================= LOGOS ================= */

.logo{
  width:60px;
  height:60px;
  object-fit:contain;
}

/* ================= EQUIPOS ================= */

.local,.visit{
  display:flex;
  flex-direction:column;
  font-size:20px;
}

.visit{ text-align:right; }

.principal{
  font-weight:900;
  line-height:1.1;
}

.detalle{
  font-size:.45em;
  opacity:.6;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.local .principal{color:#0d47a1}
.visit .principal{color:#b71c1c}

/* ================= MARCADOR (FIX DOS CIFRAS) ================= */

.score{
  text-align:center;
  font-weight:900;
  font-size:32px; /* â†“ mÃ¡s pequeÃ±o */
  font-variant-numeric: tabular-nums; /* ancho fijo nÃºmeros */
  display:flex;
  flex-direction:column;
  align-items:center;
  line-height:1.05;
}

.sets{
  font-size:.33em; /* triple mÃ¡s pequeÃ±o */
  opacity:.7;
  margin-top:2px;
}

.blue{color:#0d47a1}
.red{color:#b71c1c}

</style>
</head>

<body>

<button onclick="exportar()">ðŸ“¸ DESKARGATU JPG</button>

<div id="contenedor"></div>

<script>

/* ================= UTIL ================= */

function normalizar(nombre){
  return nombre.split("(")[0]
    .replace(/[.,]/g,"")
    .trim()
    .replace(/\s+/g,"-")
    .toUpperCase();
}

function logoClub(nombre){

  const n=normalizar(nombre);

  if(n.includes("LARRAUN"))
    return `<img class="logo" src="images/logo-larraun.png">`;

  return `<img class="logo" src="images/clubes/${n}.jpg"
          onerror="this.style.visibility='hidden'">`;
}

/* ===== split automÃ¡tico tras ")" ===== */

function bloqueEquipo(texto,clase){

  const partes=texto.split(")");

  const principal=partes[0]+")";
  const detalle=partes.slice(1).join(")").trim();

  return `
    <div class="${clase}">
      <div class="principal">${principal}</div>
      ${detalle?`<div class="detalle">${detalle}</div>`:""}
    </div>
  `;
}

/* ================= FILA ================= */

function crearFila(p){

  const [a,b]=(p.tanteoa||"-").split("-");

  return `
    <div class="fila">
      ${logoClub(p.etxekoa)}
      ${bloqueEquipo(p.etxekoa,"local")}

      <div class="score">
        <div>
          <span class="blue">${a}</span> -
          <span class="red">${b}</span>
        </div>
        ${p.sets?.length?`<div class="sets">${p.sets.join(" ")}</div>`:""}
      </div>

      ${bloqueEquipo(p.kanpokoak,"visit")}
      ${logoClub(p.kanpokoak)}
    </div>
  `;
}

/* ================= PARTIDO COMPLETO ================= */

function crearPartido(p){

  const fronton=(p.fronton||"").toLowerCase();

  const color =
    fronton.includes("lekunberri") ||
    fronton.includes("aldaz")
      ? "azul"
      : "rojo";

  return `
    <div class="partido">
      <div class="partido-header ${color}">
        ${p.fecha} Â· ${p.fronton} Â· ${p.modalidad}
      </div>
      ${crearFila(p)}
    </div>
  `;
}

/* ================= CARGA ================= */

fetch("data/resultados-larraun.json")
.then(r=>r.json())
.then(data=>{

  const pagina=document.createElement("div");
  pagina.className="pagina";

  pagina.innerHTML=`
    <div class="header">
      <img src="images/logo-larraun.png" class="logo-izq">
      <h1>EMAITZAK</h1>
      <img src="images/logo-fnp.png" class="logo-der">
    </div>
    <div class="contenido" id="lista"></div>
    <div class="footer">Larraun Pilota Elkartea</div>
  `;

  contenedor.appendChild(pagina);

  const lista=document.getElementById("lista");

  data.forEach(p=>{
    lista.insertAdjacentHTML("beforeend",crearPartido(p));
  });
});

/* ================= EXPORT ================= */

async function exportar(){
 const canvas=await html2canvas(document.querySelector(".pagina"),{scale:2,useCORS:true});
 const a=document.createElement("a");
 a.href=canvas.toDataURL("image/jpeg",0.95);
 a.download="emaitzak.jpg";
 a.click();
}

</script>

</body>
</html>
