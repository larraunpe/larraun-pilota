<!DOCTYPE html>
<html lang="eu">
<head>
<meta charset="UTF-8" />
<title>Larraun ‚Äì EMAITZAK Kartela</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>

/* ================= BASE ================= */

body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#184d33;
}

.exportar{
  text-align:center;
  margin:18px;
}

button{
  padding:10px 18px;
  font-size:14px;
  font-weight:bold;
  cursor:pointer;
}

/* ================= A3 reducido ================= */

.pagina{
  width:900px;
  height:1270px;
  margin:30px auto;
  background:#eaf3ff;
  display:flex;
  flex-direction:column;
  overflow:hidden;
  box-shadow:0 0 18px rgba(0,0,0,.4);
}

/* ================= HEADER ================= */

.header{
  height:120px;
  background:linear-gradient(#3d6fe6,#2448b5);
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  color:white;
}

.header img{
  height:70px;
  position:absolute;
  top:25px;
}

.logo-izq{ left:20px; }
.logo-der{ right:20px; }

.header h1{
  margin:0;
  font-size:34px;
  letter-spacing:3px;
}

/* ================= CONTENIDO ================= */

.contenido{
  flex:1;
  padding:16px;
}

/* ================= T√çTULO BLOQUE ================= */

.bloque h2{
  text-align:center;
  margin:10px 0 14px;
  font-size:18px;
  color:#2448b5;
  letter-spacing:2px;
}

/* ================= LISTA RESULTADOS ================= */

.lista{
  background:#fff;
  border-radius:8px;
  overflow:hidden;
}

/* FILA */

.fila{
  display:flex;
  align-items:center;
  padding:6px 8px;
  border-bottom:1px solid #ddd;
  font-weight:bold;
  font-size:13px;
  gap:6px;
}

/* colores resultado */
.win{ background:#e7f6ea; }
.lose{ background:#fdeaea; }
.pending{ background:#f2f2f2; }

/* logos */
.logo{
  height:26px;
  width:26px;
  object-fit:contain;
}

/* nombres */
.local{ color:#0d47a1; min-width:110px; }
.visit{ color:#b71c1c; min-width:110px; }

/* marcador grande */
.score{
  font-size:20px;
  font-weight:900;
  min-width:60px;
  text-align:center;
}

.blue{ color:#0d47a1; }
.red{ color:#b71c1c; }

/* sets */
.sets{
  font-size:10px;
  color:#000;
  text-align:center;
  line-height:10px;
}

/* modalidad */
.modalidad{
  margin-left:auto;
  font-size:11px;
  font-weight:600;
}

.modalidad a{
  color:#2448b5;
  text-decoration:none;
}

/* ================= FOOTER ================= */

.footer{
  background:#444;
  color:#fff;
  padding:10px;
  text-align:center;
  font-size:11px;
}

</style>
</head>

<body>

<div class="exportar">
  <button onclick="exportar()">üì∏ DESKARGATU JPG</button>
</div>

<div id="contenedorPaginas"></div>

<script>

/* ======================================================
   CREAR P√ÅGINA
====================================================== */

function nuevaPagina(){

  const p=document.createElement("div");
  p.className="pagina";

  p.innerHTML=`
    <div class="header">
      <img src="images/logo-larraun.png" class="logo-izq">
      <h1>EMAITZAK</h1>
      <img src="images/logo-fnp.png" class="logo-der">
    </div>

    <div class="contenido"></div>

    <div class="footer">Larraun Pilota Elkartea</div>
  `;

  document.getElementById("contenedorPaginas").appendChild(p);

  return p.querySelector(".contenido");
}

/* ======================================================
   CREAR BLOQUES RESULTADOS
====================================================== */

function crearBloque(titulo,data){

 if(!data.length) return [];

 const bloques=[];

 const t=document.createElement("div");
 t.className="bloque";
 t.innerHTML=`<h2>${titulo}</h2>`;
 bloques.push(t);

 const lista=document.createElement("div");
 lista.className="lista";

 data.forEach(p=>{

   const fila=document.createElement("div");
   fila.className="fila";

   const estado=(p.emaitza||"").toLowerCase();

   if(!estado) fila.classList.add("pending");
   else if(estado==="irabazita") fila.classList.add("win");
   else fila.classList.add("lose");

   const [a,b]=(p.tanteoa||"-").split("-");

   fila.innerHTML=`
     <img class="logo" src="${p.localLogo||'images/logo-larraun.png'}">
     <div class="local">${p.etxekoa||""}</div>

     <div>
       <div class="score">
         <span class="blue">${a||""}</span>-
         <span class="red">${b||""}</span>
       </div>
       ${p.sets?.length?`<div class="sets">${p.sets.join(" ")}</div>`:""}
     </div>

     <div class="visit">${p.kanpokoak||""}</div>
     <img class="logo" src="${p.visitLogo||''}">

     <div class="modalidad">
       ${p.url?`<a href="${p.url}" target="_blank">${p.modalidad}</a>`:p.modalidad||""}
     </div>
   `;

   lista.appendChild(fila);

 });

 bloques.push(lista);

 return bloques;
}

/* ======================================================
   PAGINACI√ìN
====================================================== */

function paginar(bloques){

 let contenido=nuevaPagina();

 bloques.forEach(b=>{

   contenido.appendChild(b);

   if(contenido.scrollHeight>contenido.clientHeight){
     contenido.removeChild(b);
     contenido=nuevaPagina();
     contenido.appendChild(b);
   }

 });
}

/* ======================================================
   FETCH DATOS
====================================================== */

Promise.all([
 fetch("data/resultados-larraun.json").then(r=>r.json()),
 fetch("data/resultados-no-oficiales.json").then(r=>r.json())
]).then(([oficiales,noOficiales])=>{

 const bloques=[
   ...crearBloque("EMAITZA OFIZIALAK",oficiales),
   ...crearBloque("BESTE EMAITZAK",noOficiales)
 ];

 paginar(bloques);

});

/* ======================================================
   EXPORTAR JPG
====================================================== */

async function exportar(){

 const paginas=document.querySelectorAll(".pagina");

 let i=1;

 for(const p of paginas){

   const canvas=await html2canvas(p,{scale:2,useCORS:true});

   const a=document.createElement("a");
   a.href=canvas.toDataURL("image/jpeg",0.95);
   a.download=`emaitzak-${i}.jpg`;
   a.click();

   i++;
 }
}

</script>

</body>
</html>
